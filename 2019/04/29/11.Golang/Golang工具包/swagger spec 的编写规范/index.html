<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">



  
  
  <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">










<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.2" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.jpg?v=6.4.2">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpg?v=6.4.2">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.jpg?v=6.4.2">


  <link rel="mask-icon" href="/images/favicon.jpg?v=6.4.2" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.2',
    sidebar: {"position":"left","width":280,"display":"always","offset":25,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="一、Swagger简介什么是swaggerSwagger是一个简单但功能强大的API表达工具。它具有地球上最大的API工具生态系统，数以千计的开发人员，使用几乎所有的现代编程语言，都在支持和使用Swagger。使用Swagger生成API，我们可以得到交互式文档，自动生成代码的SDK以及API的发现特性等。 Go swagger文档配置文件示例123456789101112131415161718">
<meta property="og:type" content="article">
<meta property="og:title" content="swagger spec 的编写规范">
<meta property="og:url" content="http://blog.kyleliu.cn/2019/04/29/11.Golang/Golang%E5%B7%A5%E5%85%B7%E5%8C%85/swagger%20spec%20%E7%9A%84%E7%BC%96%E5%86%99%E8%A7%84%E8%8C%83/index.html">
<meta property="og:site_name" content="刘小恺(Kyle)的云笔记">
<meta property="og:description" content="一、Swagger简介什么是swaggerSwagger是一个简单但功能强大的API表达工具。它具有地球上最大的API工具生态系统，数以千计的开发人员，使用几乎所有的现代编程语言，都在支持和使用Swagger。使用Swagger生成API，我们可以得到交互式文档，自动生成代码的SDK以及API的发现特性等。 Go swagger文档配置文件示例123456789101112131415161718">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://apihandyman.io/wp-content/uploads/2016/07/openapi8-editor-error.png">
<meta property="og:image" content="http://apihandyman.io/wp-content/uploads/2016/07/openapi8-editor-preferences-pointer-modified.png">
<meta property="article:published_time" content="2019-04-29T05:45:00.000Z">
<meta property="article:modified_time" content="2019-05-27T09:33:36.000Z">
<meta property="article:author" content="刘小恺(Kyle)">
<meta property="article:tag" content="Golang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://apihandyman.io/wp-content/uploads/2016/07/openapi8-editor-error.png">






  <link rel="canonical" href="http://blog.kyleliu.cn/2019/04/29/11.Golang/Golang工具包/swagger spec 的编写规范/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>swagger spec 的编写规范 | 刘小恺(Kyle)的云笔记</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?61af49e7933cbd35801eb5e4ca789a8d";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">刘小恺(Kyle)的云笔记</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">吃喝玩乐、好吃懒做、醉生梦死、不劳而获</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://blog.kyleliu.cn/2019/04/29/11.Golang/Golang%E5%B7%A5%E5%85%B7%E5%8C%85/swagger%20spec%20%E7%9A%84%E7%BC%96%E5%86%99%E8%A7%84%E8%8C%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="刘小恺(Kyle)">
      <meta itemprop="description" content="吃喝玩乐、好吃懒做、醉生梦死、不劳而获">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="刘小恺(Kyle)的云笔记">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">swagger spec 的编写规范
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-04-29 13:45:00" itemprop="dateCreated datePublished" datetime="2019-04-29T13:45:00+08:00">2019-04-29</time>
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Golang/" itemprop="url" rel="index"><span itemprop="name">Golang</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Golang/Golang%E5%B7%A5%E5%85%B7%E5%8C%85/" itemprop="url" rel="index"><span itemprop="name">Golang工具包</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/29/11.Golang/Golang%E5%B7%A5%E5%85%B7%E5%8C%85/swagger%20spec%20%E7%9A%84%E7%BC%96%E5%86%99%E8%A7%84%E8%8C%83/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/04/29/11.Golang/Golang%E5%B7%A5%E5%85%B7%E5%8C%85/swagger%20spec%20%E7%9A%84%E7%BC%96%E5%86%99%E8%A7%84%E8%8C%83/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="一、Swagger简介"><a href="#一、Swagger简介" class="headerlink" title="一、Swagger简介"></a>一、Swagger简介</h2><h3 id="什么是swagger"><a href="#什么是swagger" class="headerlink" title="什么是swagger"></a>什么是swagger</h3><p>Swagger是一个简单但功能强大的API表达工具。它具有地球上最大的API工具生态系统，数以千计的开发人员，使用几乎所有的现代编程语言，都在支持和使用Swagger。使用Swagger生成API，我们可以得到交互式文档，自动生成代码的SDK以及API的发现特性等。</p>
<h3 id="Go-swagger文档配置文件示例"><a href="#Go-swagger文档配置文件示例" class="headerlink" title="Go swagger文档配置文件示例"></a>Go swagger文档配置文件示例</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">From</span> <span class="string">the</span> <span class="string">todo</span> <span class="string">list</span> <span class="string">tutorial</span> <span class="string">on</span> <span class="string">goswagger.io</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">A</span> <span class="string">Todo</span> <span class="string">list</span> <span class="string">application</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line"><span class="attr">consumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">application/io.goswagger.examples.todo-list.v1+json</span></span><br><span class="line"><span class="attr">produces:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">application/io.goswagger.examples.todo-list.v1+json</span></span><br><span class="line"><span class="attr">schemes:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">http</span></span><br><span class="line"><span class="attr">definitions:</span></span><br><span class="line">  <span class="attr">item:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">object</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">description</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">id:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">int64</span></span><br><span class="line">        <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">description:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">minLength:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">completed:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">tags:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">todos</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">since</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">int64</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">limit</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">int32</span></span><br><span class="line">          <span class="attr">default:</span> <span class="number">20</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">list</span> <span class="string">the</span> <span class="string">todo</span> <span class="string">operations</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="string">$ref:</span> <span class="string">"#/definitions/item"</span></span><br></pre></td></tr></table></figure>

<h3 id="Go-swagger-环境安装"><a href="#Go-swagger-环境安装" class="headerlink" title="Go-swagger 环境安装"></a>Go-swagger 环境安装</h3><ol>
<li><p>安装依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">go get github.com&#x2F;go-openapi&#x2F;errors</span><br><span class="line"></span><br><span class="line">go get github.com&#x2F;go-openapi&#x2F;loads</span><br><span class="line"></span><br><span class="line">go get github.com&#x2F;go-openapi&#x2F;runtime</span><br><span class="line"></span><br><span class="line">go get github.com&#x2F;go-openapi&#x2F;spec</span><br><span class="line"></span><br><span class="line">go get github.com&#x2F;go-openapi&#x2F;strfmt</span><br><span class="line"></span><br><span class="line">go get github.com&#x2F;go-openapi&#x2F;swag</span><br><span class="line"></span><br><span class="line">go get github.com&#x2F;go-openapi&#x2F;validate</span><br><span class="line"></span><br><span class="line">go get github.com&#x2F;jessevdk&#x2F;go-flags</span><br><span class="line"></span><br><span class="line">go get golang.org&#x2F;x&#x2F;net&#x2F;context</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装swagger </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get -u github.com&#x2F;go-swagger&#x2F;go-swagger&#x2F;cmd&#x2F;swagger</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="语言选择-JSON-vs-YAML"><a href="#语言选择-JSON-vs-YAML" class="headerlink" title="语言选择: JSON vs YAML"></a>语言选择: JSON vs YAML</h3><p>我们可以选择使用JSON或者YAML的语言格式来编写API文档。但是个人建议使用YAML来写，原因是<strong>它更简单</strong>。一图胜千言，先看用JSON写的文档：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"swagger"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">    <span class="attr">"info"</span>: &#123;</span><br><span class="line">        <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">        <span class="attr">"title"</span>: <span class="string">"Simple API"</span>,</span><br><span class="line">        <span class="attr">"description"</span>: <span class="string">"A simple API to learn how to write OpenAPI Specification"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"schemes"</span>: [</span><br><span class="line">        <span class="string">"https"</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"host"</span>: <span class="string">"simple.api"</span>,</span><br><span class="line">    <span class="attr">"basePath"</span>: <span class="string">"/openapi101"</span>,</span><br><span class="line">    <span class="attr">"paths"</span>: &#123;</span><br><span class="line">        <span class="attr">"/persons"</span>: &#123;</span><br><span class="line">            <span class="attr">"get"</span>: &#123;</span><br><span class="line">                <span class="attr">"summary"</span>: <span class="string">"Gets some persons"</span>,</span><br><span class="line">                <span class="attr">"description"</span>: <span class="string">"Returns a list containing all persons."</span>,</span><br><span class="line">                <span class="attr">"responses"</span>: &#123;</span><br><span class="line">                    <span class="attr">"200"</span>: &#123;</span><br><span class="line">                        <span class="attr">"description"</span>: <span class="string">"A list of Person"</span>,</span><br><span class="line">                        <span class="attr">"schema"</span>: &#123;</span><br><span class="line">                            <span class="attr">"type"</span>: <span class="string">"array"</span>,</span><br><span class="line">                            <span class="attr">"items"</span>: &#123;</span><br><span class="line">                                <span class="attr">"properties"</span>: &#123;</span><br><span class="line">                                    <span class="attr">"firstName"</span>: &#123;</span><br><span class="line">                                        <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">                                    &#125;,</span><br><span class="line">                                    <span class="attr">"lastName"</span>: &#123;</span><br><span class="line">                                        <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">                                    &#125;,</span><br><span class="line">                                    <span class="attr">"username"</span>: &#123;</span><br><span class="line">                                        <span class="attr">"type"</span>: <span class="string">"string"</span></span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再来看看同一份API文档的YAML实现：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schemes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">simple.api</span></span><br><span class="line"><span class="attr">basePath:</span> <span class="string">/openapi101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="attr">required:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">              <span class="attr">properties:</span></span><br><span class="line">                <span class="attr">firstName:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">lastName:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">username:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<p>对于普通人来说，似乎用YAML更能够简化书写和阅读。这里我们并没有非此即彼的选择问题，因为：</p>
<ul>
<li>几乎所用支持OpenAPI规范的工具都支持YAML</li>
<li>有很多的工具可以实现YAML-JSON之间的转换</li>
</ul>
<p>所以，用自己喜欢的方式书写即可。（后面的示例文档也都是用YAML来写的。强烈推荐使用YAML。）</p>
<hr>
<h2 id="二、基本的swagger-api定义方法"><a href="#二、基本的swagger-api定义方法" class="headerlink" title="二、基本的swagger api定义方法"></a>二、基本的swagger api定义方法</h2><h3 id="2-1-最简单的例子"><a href="#2-1-最简单的例子" class="headerlink" title="2.1 最简单的例子"></a>2.1 最简单的例子</h3><p>我们从一个最简单（几乎没有东西）的API文档开始：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schemes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">simple.api</span></span><br><span class="line"><span class="attr">basePath:</span> <span class="string">/openapi101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">paths:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure>

<p>这个文档的内容分成四部分，下面分别来说明。</p>
<h4 id="2-1-1-OpenAPI规范的版本号"><a href="#2-1-1-OpenAPI规范的版本号" class="headerlink" title="2.1.1 OpenAPI规范的版本号"></a>2.1.1 OpenAPI规范的版本号</h4><p>首先我们要通过一个<code>swagger</code>属性来声明OpenAPI规范的版本。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br></pre></td></tr></table></figure>

<p>你没看错，是<code>swagger</code>，上面已经介绍了，OpenAPI规范是基于Swagger的，在未来的版本中，这个属性可能会换成别的。 目前这个属性的值，暂时只能填写为<code>2.0</code>。</p>
<h4 id="2-1-2-API描述信息"><a href="#2-1-2-API描述信息" class="headerlink" title="2.1.2 API描述信息"></a>2.1.2 API描述信息</h4><p>然后我们需要说明一下API文档的相关信息，比如API文档版本（注意不同于上面的规范版本）、API文档名称已经可选的描述信息。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification</span></span><br></pre></td></tr></table></figure>

<h4 id="2-1-3-API的URL"><a href="#2-1-3-API的URL" class="headerlink" title="2.1.3 API的URL"></a>2.1.3 API的URL</h4><p>作为web API，一个很重要的信息就是用来给消费者使用的<code>根URL</code>，可以用协议（http或者https）、主机名、根路径来描述：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">schemes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">simple.api</span></span><br><span class="line"><span class="attr">basePath:</span> <span class="string">/openapi101</span></span><br></pre></td></tr></table></figure>

<p>这这个例子中，消费者把<code>https://simple.api/open101</code>作为根节点来访问各种API。因为和具体环境有关，不涉及API描述的根本内容，所以这部分信息是可选的。</p>
<h4 id="2-1-4-API的操作（operation）"><a href="#2-1-4-API的操作（operation）" class="headerlink" title="2.1.4 API的操作（operation）"></a>2.1.4 API的操作（operation）</h4><p>这个例子中，我们没有写API的操作，用一个YAML的空对象<code>{}</code>先占个位置。</p>
<h3 id="2-2-定义一个API操作"><a href="#2-2-定义一个API操作" class="headerlink" title="2.2 定义一个API操作"></a>2.2 定义一个API操作</h3><p>如果我们要展示一组用户信息，可以这样描述：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schemes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">simple.api</span></span><br><span class="line"><span class="attr">basePath:</span> <span class="string">/openapi101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="attr">required:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">              <span class="attr">properties:</span></span><br><span class="line">                <span class="attr">firstName:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">lastName:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">username:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-1-添加一个路径（path）"><a href="#2-2-1-添加一个路径（path）" class="headerlink" title="2.2.1 添加一个路径（path）"></a>2.2.1 添加一个<code>路径</code>（path）</h4><p>我们添加一个<code>/persons</code>的<code>路径</code>，用来访问一组用户信息：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-2-在路径中添加一个HTTP方法"><a href="#2-2-2-在路径中添加一个HTTP方法" class="headerlink" title="2.2.2 在路径中添加一个HTTP方法"></a>2.2.2 在路径中添加一个HTTP方法</h4><p>在每个<code>路径</code>中，我们可以添加任意的<a href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods" target="_blank" rel="noopener">HTTP动词</a>来操作所需要的资源。</p>
<p>比如需要展示一组用户信息，我们可以在<code>/persons</code>路径中添加<code>get</code>方法，同时还可以填写一些简单的描述信息（summary）或者说明该方法的一段长篇大论（description）。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">get:</span></span><br><span class="line">  <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span></span><br></pre></td></tr></table></figure>

<p>这样一来，我们调 <code>get https://simple.api/open101/persons</code>方法就能获取一个用户信息列表了。</p>
<h4 id="2-2-3-定义响应（response）类型"><a href="#2-2-3-定义响应（response）类型" class="headerlink" title="2.2.3 定义响应（response）类型"></a>2.2.3 定义<code>响应</code>（response）类型</h4><p>对于每个方法（或操作），我们都可以在<code>响应</code>(responses)中添加任意的HTTP状态码（比如<em>200 OK</em> 或者 <em>404 Not Found</em>等）。这个例子中我们添加上<code>200</code>的响应：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">200:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br></pre></td></tr></table></figure>

<h4 id="2-2-4-定义响应内容"><a href="#2-2-4-定义响应内容" class="headerlink" title="2.2.4 定义响应内容"></a>2.2.4 定义响应内容</h4><p><em>get /persons</em>这个接口返回一组用户信息，我们通过响应消息中的<code>模式</code>（schema）属性来描述清楚具体的返回内容。</p>
<p>一组用户信息就是一个用户信息对象的<code>数组</code>（array），每一个数组元素则是一个用户信息<code>对象</code>（object），该对象包含三个string类型的属性：<code>姓氏</code>、<code>名字</code>、<code>用户名</code>，其中<code>用户名</code>必须提供（required）。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">schema:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">  <span class="attr">items:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-定义请求参数（query-parameters）"><a href="#2-3-定义请求参数（query-parameters）" class="headerlink" title="2.3 定义请求参数（query parameters）"></a>2.3 定义<code>请求参数</code>（query parameters）</h3><p>用户太多，我们不想一股脑全部输出出来。这个时候，分页输出是个不错的选择，我们可以通过添加请求参数来实现。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schemes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">simple.api</span></span><br><span class="line"><span class="attr">basePath:</span> <span class="string">/openapi101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line"><span class="comment"># END ############################################################################      </span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="attr">required:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">              <span class="attr">properties:</span></span><br><span class="line">                <span class="attr">firstName:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">lastName:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">username:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-1-在get方法中增加请求参数"><a href="#2-3-1-在get方法中增加请求参数" class="headerlink" title="2.3.1 在get方法中增加请求参数"></a>2.3.1 在<em>get</em>方法中增加请求参数</h4><p>首先我们在 <em>get</em> 方法中增加一个<code>参数</code>属性：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-2-添加分页参数"><a href="#2-3-2-添加分页参数" class="headerlink" title="2.3.2 添加分页参数"></a>2.3.2 添加分页参数</h4><p>在参数列表中，我们添加两个名字（name）分别叫做<code>pageSize</code>和<code>pageNumber</code>的整型（integer）参数，并作简单描述：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">      <span class="attr">parameters:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line"><span class="comment"># END ##############################################################################</span></span><br><span class="line">      <span class="attr">responses:</span></span><br></pre></td></tr></table></figure>

<p>这样一来，消费者就可以通过 <em>get /persons?pageSize=20&amp;pageNumber=2</em> 来访问第2页的用户信息（不超过20条）了。</p>
<h3 id="2-4-定义路径参数（path-parameter）"><a href="#2-4-定义路径参数（path-parameter）" class="headerlink" title="2.4 定义路径参数（path parameter）"></a>2.4 定义<code>路径参数</code>（path parameter）</h3><p>有时候我们想要根据用户名来查找用户信息，这时我们需要增加一个接口操作，比如可以添加一个类似 <em>/persons/{username}</em> 的操作来获取用户信息。注意，<em>{username}</em> 是在请求路径中的参数。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schemes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">simple.api</span></span><br><span class="line"><span class="attr">basePath:</span> <span class="string">/openapi101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="attr">required:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">              <span class="attr">properties:</span></span><br><span class="line">                <span class="attr">firstName:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">lastName:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">username:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">for</span> <span class="string">its</span> <span class="string">username</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">firstName:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">lastName:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">username:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">Person</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exists.</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="2-4-1-添加一个-get-persons-username-操作"><a href="#2-4-1-添加一个-get-persons-username-操作" class="headerlink" title="2.4.1 添加一个 get /persons/{username} 操作"></a>2.4.1 添加一个 <em>get /persons/{username}</em> 操作</h4><p>首先我们在 <em>/persons</em> 路径后面，增加一个 <em>/persons/{username}</em> 的路径，并定义一个 <em>get</em> （操作）方法。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schemes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">simple.api</span></span><br><span class="line"><span class="attr">basePath:</span> <span class="string">/openapi101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">                <span class="attr">username:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">for</span> <span class="string">its</span> <span class="string">username</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="2-4-2-定义路径参数-username"><a href="#2-4-2-定义路径参数-username" class="headerlink" title="2.4.2 定义路径参数 username"></a>2.4.2 定义路径参数 <em>username</em></h4><p>因为 <em>{username}</em> 是路径参数，我们需要先像请求参数一样将它添加到 <em>parameters</em> 属性中，注意名称应该同上面大括号（ <em>{ }</em> ） 里面的名称一致。并通过 <code>in</code> 这个属性，来表示它是一个路径（path）参数。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">    <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<p>定义路径参数时很容易出现的问题就是忘记：<code>required: true</code>，Swagger的自动完成功能中没有包含这个属性定义。 如果没有写 <em>require</em> 属性，默认值是 <strong>false</strong>，也就是说 <em>username</em> 参数时可选的。可事实上，作为路径参数，它是必需的。</p>
<h4 id="2-4-3-定义响应消息"><a href="#2-4-3-定义响应消息" class="headerlink" title="2.4.3 定义响应消息"></a>2.4.3 定义响应消息</h4><p>别忘了获取单个用户信息也需要填写 <em>200</em> 响应消息，响应消息体的内容就是之前描述过的用户信息（用户信息列表中的一个元素）：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">200:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">required:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">firstName:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">lastName:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">username:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<p>当然，API的提供者会对 <em>username</em> 进行校验，如果查无此人，应该返回 <em>404</em> 的异常状态。所以我们再加上 <em>404</em> 状态的响应：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">404:</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">The</span> <span class="string">Person</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exists.</span></span><br></pre></td></tr></table></figure>

<h3 id="2-5-定义消息体参数（body-parameter）"><a href="#2-5-定义消息体参数（body-parameter）" class="headerlink" title="2.5 定义消息体参数（body parameter）"></a>2.5 定义<code>消息体参数</code>（body parameter）</h3><p>当我们需要添加一个用户信息时，我们需要一个能够提供 <em>post /persons</em> 的API操作。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schemes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">simple.api</span></span><br><span class="line"><span class="attr">basePath:</span> <span class="string">/openapi101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line">              <span class="attr">required:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">              <span class="attr">properties:</span></span><br><span class="line">                <span class="attr">firstName:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">lastName:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">username:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">firstName:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">lastName:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">username:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">204:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">succesfully</span> <span class="string">created.</span></span><br><span class="line">        <span class="attr">400:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">couldn't</span> <span class="string">have</span> <span class="string">been</span> <span class="string">created.</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">for</span> <span class="string">its</span> <span class="string">username.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">firstName:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">lastName:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">username:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">Person</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exists.</span></span><br></pre></td></tr></table></figure>

<h4 id="2-5-1-添加一个-post-persons-操作"><a href="#2-5-1-添加一个-post-persons-操作" class="headerlink" title="2.5.1 添加一个 post /persons 操作"></a>2.5.1 添加一个 <em>post /persons</em> 操作</h4><p>首先在 <em>/persons</em> 路径下廷加一个 <em>post</em> 操作：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br></pre></td></tr></table></figure>

<h4 id="2-5-2-定义消息体参数"><a href="#2-5-2-定义消息体参数" class="headerlink" title="2.5.2 定义消息体参数"></a>2.5.2 定义消息体参数</h4><p>接下来我们给 <em>post</em> 方法添加参数，通过 <code>in</code> 属性显式说明参数是在 <em>body</em> 中的。参数的定义参考 <em>get /persons/{username}</em> 的 <em>200</em> 响应消息体参数，也就是包含用户的姓氏、名字、用户名。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">required:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">firstName:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">lastName:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">username:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<h4 id="2-5-3-定义响应消息"><a href="#2-5-3-定义响应消息" class="headerlink" title="2.5.3 定义响应消息"></a>2.5.3 定义响应消息</h4><p>最后不要忘记定义 <em>post</em> 操作的响应消息。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">204:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">succesfully</span> <span class="string">created.</span></span><br><span class="line">  <span class="attr">400:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">couldn't</span> <span class="string">have</span> <span class="string">been</span> <span class="string">created.</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="三、文档瘦身"><a href="#三、文档瘦身" class="headerlink" title="三、文档瘦身"></a>三、文档瘦身</h2><p>现在我们已经学会了编写API文档的基本方法。不过上面的例子中存在一些重复，这对于程序员的嗅觉来说，就是代码的“坏味道”。这一章我们一起学习如何通过抽取可重用的定义（definitions）来简化API文档。</p>
<h3 id="3-1-简化数据模型"><a href="#3-1-简化数据模型" class="headerlink" title="3.1 简化数据模型"></a>3.1 简化数据模型</h3><p>我们认真观察第2章最后输出的API文档，很容易发现 <em>Person</em> 的定义出现了三次，非常的不 <code>DRY</code>☹。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schemes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">simple.api</span></span><br><span class="line"><span class="attr">basePath:</span> <span class="string">/openapi101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">            <span class="attr">items:</span></span><br><span class="line"><span class="comment">#START 第1次定义###################################################################</span></span><br><span class="line">              <span class="attr">required:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">              <span class="attr">properties:</span></span><br><span class="line">                <span class="attr">firstName:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">lastName:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">                <span class="attr">username:</span></span><br><span class="line">                  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END  第1次定义###################################################################</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line"><span class="comment">#START 第2次定义###################################################################</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">firstName:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">lastName:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">username:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END  第2次定义###################################################################</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">204:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">succesfully</span> <span class="string">created.</span></span><br><span class="line">        <span class="attr">400:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">couldn't</span> <span class="string">have</span> <span class="string">been</span> <span class="string">created.</span></span><br><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">for</span> <span class="string">its</span> <span class="string">username.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line"><span class="comment">#START 第3次定义###################################################################</span></span><br><span class="line">            <span class="attr">required:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">firstName:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">lastName:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">username:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END  第3次定义###################################################################</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">Person</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exists.</span></span><br></pre></td></tr></table></figure>

<p>现在，我们通过可重用的<code>定义</code> （definition）来重构这个文档：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schemes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">simple.api</span></span><br><span class="line"><span class="attr">basePath:</span> <span class="string">/openapi101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Persons"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">204:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">succesfully</span> <span class="string">created.</span></span><br><span class="line">        <span class="attr">400:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">couldn't</span> <span class="string">have</span> <span class="string">been</span> <span class="string">created.</span></span><br><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">for</span> <span class="string">its</span> <span class="string">username.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">Person</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exists.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#START 新增定义####################################################################</span></span><br><span class="line"><span class="attr">definitions:</span></span><br><span class="line">  <span class="attr">Person:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">Persons:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">    <span class="attr">items:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line"><span class="comment"># END 新增定义####################################################################</span></span><br></pre></td></tr></table></figure>

<p>文档简化了很多。这得益于<a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#swaggerObject" target="_blank" rel="noopener">OpenAPI规范中关于定义（definition）的章节中</a>允许我们“一处定义，处处使用”。</p>
<h4 id="3-1-1-添加定义-（definitions）项"><a href="#3-1-1-添加定义-（definitions）项" class="headerlink" title="3.1.1 添加定义 （definitions）项"></a>3.1.1 添加<code>定义</code> （definitions）项</h4><p>我们首先在API文档的尾部添加一个<code>定义</code> （definitions）项（其实它也可以放在文档的任意位置，只不过大家习惯放在文档末尾）：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">Person</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exists.</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line"><span class="attr">definitions:</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-2-增加一个可重用的（对象）定义"><a href="#3-1-2-增加一个可重用的（对象）定义" class="headerlink" title="3.1.2 增加一个可重用的（对象）定义"></a>3.1.2 增加一个可重用的（对象）<code>定义</code></h4><p>然后我们增加一个 <em>Person</em> 对象的定义：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">definitions:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">  <span class="attr">Person:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-3-引用一个定义来增加另一个定义"><a href="#3-1-3-引用一个定义来增加另一个定义" class="headerlink" title="3.1.3 引用一个定义来增加另一个定义"></a>3.1.3 引用一个<code>定义</code>来增加另一个<code>定义</code></h4><p>在定义项中，我们可以立即引用刚才定义好的 <em>Person</em> 来增加另一个<code>定义</code>，<em>Persons<em>。</em>Persons</em> 是一个 <em>Person</em> 对象的数组。与之前直接定义的不同之处是，我们增加了一个<code>引用</code>（<em>reference*）属性，也就是 *$ref</em> 来引用 <em>Person</em> 。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Persons:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">  <span class="attr">items:</span></span><br><span class="line">    <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-4-在响应消息中使用定义"><a href="#3-1-4-在响应消息中使用定义" class="headerlink" title="3.1.4 在响应消息中使用定义"></a>3.1.4 在响应消息中使用<code>定义</code></h4><p>一旦定义好了 <em>Person</em> ，我们可以把原来在响应消息中相应的定义字段替换掉。</p>
<h5 id="3-1-4-1-get-persons"><a href="#3-1-4-1-get-persons" class="headerlink" title="3.1.4.1 get/persons"></a>3.1.4.1 get/persons</h5><p>原来：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">200:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">      <span class="attr">items:</span></span><br><span class="line">        <span class="attr">required:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">firstName:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">lastName:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<p>现在：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">200:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/definitions/Persons"</span></span><br></pre></td></tr></table></figure>

<h5 id="3-1-4-2-get-persons-username"><a href="#3-1-4-2-get-persons-username" class="headerlink" title="3.1.4.2 get/persons/{username}"></a>3.1.4.2 get/persons/{username}</h5><p>原来：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">200:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="attr">required:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">      <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">firstName:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">lastName:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">username:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<p>现在：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">200:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br></pre></td></tr></table></figure>

<h4 id="3-1-5-在参数中使用定义"><a href="#3-1-5-在参数中使用定义" class="headerlink" title="3.1.5 在参数中使用定义"></a>3.1.5 在参数中使用<code>定义</code></h4><p>不仅仅在消息中可以使用<code>定义</code>，在参数中也可以使用。</p>
<h5 id="3-1-5-1-post-persons"><a href="#3-1-5-1-post-persons" class="headerlink" title="3.1.5.1 post /persons"></a>3.1.5.1 post /persons</h5><p>原来：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post:</span></span><br><span class="line">  <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">  <span class="attr">parameters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">      <span class="attr">schema:</span></span><br><span class="line">        <span class="attr">required:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">        <span class="attr">properties:</span></span><br><span class="line">          <span class="attr">firstName:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">lastName:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">username:</span></span><br><span class="line">            <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<p>现在：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post:</span></span><br><span class="line">  <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">  <span class="attr">parameters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">      <span class="attr">schema:</span></span><br><span class="line">        <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-简化响应消息"><a href="#3-2-简化响应消息" class="headerlink" title="3.2 简化响应消息"></a>3.2 简化响应消息</h3><p>我们看到了<code>引用</code> （<em>$ref</em>）的作用，接下来我们再把它用到响应消息的定义中：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schemes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">simple.api</span></span><br><span class="line"><span class="attr">basePath:</span> <span class="string">/openapi101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Persons"</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">204:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">succesfully</span> <span class="string">created.</span></span><br><span class="line">        <span class="attr">400:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">couldn't</span> <span class="string">have</span> <span class="string">been</span> <span class="string">created.</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line"></span><br><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">for</span> <span class="string">its</span> <span class="string">username.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">Person</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exists.</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="attr">definitions:</span></span><br><span class="line">  <span class="attr">Person:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">Persons:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">    <span class="attr">items:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">  <span class="attr">Error:</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">code:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">message:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"></span><br><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">Standard500ErrorResponse:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">An</span> <span class="string">unexpected</span> <span class="string">error</span> <span class="string">occured.</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/definitions/Error"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-1-定义可重用的HTTP-500-响应"><a href="#3-2-1-定义可重用的HTTP-500-响应" class="headerlink" title="3.2.1 定义可重用的HTTP 500 响应"></a>3.2.1 定义可重用的HTTP 500 响应</h4><p>发生HTTP 500错误时，假如我们希望每一个API操作都返回一个带有错误码（error code）和描述信息（message）的响应，我们可以这样做：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Persons"</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">An</span> <span class="string">unexpected</span> <span class="string">error</span> <span class="string">occured.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">code:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">message:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">204:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">succesfully</span> <span class="string">created.</span></span><br><span class="line">        <span class="attr">400:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">couldn't</span> <span class="string">have</span> <span class="string">been</span> <span class="string">created.</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">An</span> <span class="string">unexpected</span> <span class="string">error</span> <span class="string">occured.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">code:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">message:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line"></span><br><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">for</span> <span class="string">its</span> <span class="string">username.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">Person</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exists.</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">An</span> <span class="string">unexpected</span> <span class="string">error</span> <span class="string">occured.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">code:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">message:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-2-增加一个Error定义"><a href="#3-2-2-增加一个Error定义" class="headerlink" title="3.2.2 增加一个Error定义"></a>3.2.2 增加一个Error定义</h4><p>按照“一处定义、处处引用”的原则，我们可以在定义项中增加 <em>Error</em> 的定义：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">definitions:</span></span><br><span class="line">  <span class="attr">Person:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">Persons:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">    <span class="attr">items:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">  <span class="attr">Error:</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">code:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">message:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<p>而且我们也学会了使用<code>引用</code>（<em>$ref</em>），所以我们可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Persons"</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">An</span> <span class="string">unexpected</span> <span class="string">error</span> <span class="string">occured.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Error"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">204:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">succesfully</span> <span class="string">created.</span></span><br><span class="line">        <span class="attr">400:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">couldn't</span> <span class="string">have</span> <span class="string">been</span> <span class="string">created.</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">An</span> <span class="string">unexpected</span> <span class="string">error</span> <span class="string">occured.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Error"</span>   </span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">for</span> <span class="string">its</span> <span class="string">username.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">Person</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exists.</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">An</span> <span class="string">unexpected</span> <span class="string">error</span> <span class="string">occured.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Error"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="3-2-3-定义一个可重用的响应消息"><a href="#3-2-3-定义一个可重用的响应消息" class="headerlink" title="3.2.3 定义一个可重用的响应消息"></a>3.2.3 定义一个可重用的响应消息</h4><p>上面的文档中，还是有一些重复的内容。我们可以根据OpenAPI规范中的<a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#swaggerObject" target="_blank" rel="noopener">responses</a>章节的描述，通过定义一个可重用的响应消息，来进一步简化文档。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">definitions:</span></span><br><span class="line">  <span class="attr">Person:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">Persons:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">    <span class="attr">items:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">  <span class="attr">Error:</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">code:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">message:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">Standard500ErrorResponse:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">An</span> <span class="string">unexpected</span> <span class="string">error</span> <span class="string">occured.</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/definitions/Error"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<p>注意：响应消息中引用了 <em>Error</em> 的定义。</p>
<h4 id="3-2-4-使用已定义的响应消息"><a href="#3-2-4-使用已定义的响应消息" class="headerlink" title="3.2.4 使用已定义的响应消息"></a>3.2.4 使用已定义的响应消息</h4><p>我们还是通过<code>引用</code>（<em>$ref</em>）来使用一个已经定义好的响应消息，比如：</p>
<h5 id="3-2-4-1-get-users"><a href="#3-2-4-1-get-users" class="headerlink" title="3.2.4.1 get /users"></a>3.2.4.1 get /users</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Persons"</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h5 id="3-2-4-2-post-users"><a href="#3-2-4-2-post-users" class="headerlink" title="3.2.4.2 post/users"></a>3.2.4.2 post/users</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">204:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">succesfully</span> <span class="string">created.</span></span><br><span class="line">        <span class="attr">400:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Persons</span> <span class="string">couldn't</span> <span class="string">have</span> <span class="string">been</span> <span class="string">created.</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h5 id="3-2-4-3-get-users-username"><a href="#3-2-4-3-get-users-username" class="headerlink" title="3.2.4.3 get/users/{username}"></a>3.2.4.3 get/users/{username}</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">Person</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exists.</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-简化参数定义"><a href="#3-3-简化参数定义" class="headerlink" title="3.3 简化参数定义"></a>3.3 简化参数定义</h3><p>类似数据模型、响应消息的简化，参数定义的简化也很容易。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">"2.0"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification</span></span><br><span class="line"></span><br><span class="line"><span class="attr">schemes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">https</span></span><br><span class="line"><span class="attr">host:</span> <span class="string">simple.api</span></span><br><span class="line"><span class="attr">basePath:</span> <span class="string">/openapi101</span></span><br><span class="line"></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/parameters/pageSize"</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/parameters/pageNumber"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Persons"</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">204:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Person</span> <span class="string">succesfully</span> <span class="string">created.</span></span><br><span class="line">        <span class="attr">400:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Person</span> <span class="string">couldn't</span> <span class="string">have</span> <span class="string">been</span> <span class="string">created.</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line"></span><br><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/parameters/username"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">for</span> <span class="string">its</span> <span class="string">username.</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/PersonDoesNotExistResponse"</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line">    <span class="attr">delete:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Deletes</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Delete</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">identified</span> <span class="string">via</span> <span class="string">its</span> <span class="string">username</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">204:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Person</span> <span class="string">successfully</span> <span class="string">deleted.</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/PersonDoesNotExistResponse"</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line"></span><br><span class="line">  <span class="string">/persons/&#123;username&#125;/friends:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/parameters/username"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person's</span> <span class="string">friends</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/parameters/pageSize"</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/parameters/pageNumber"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">person's</span> <span class="string">friends</span> <span class="string">list</span> </span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Persons"</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/PersonDoesNotExistResponse"</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">definitions:</span></span><br><span class="line">  <span class="attr">Person:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">Persons:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">    <span class="attr">items:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">  <span class="attr">Error:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">code</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">message</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">code:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">message:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"></span><br><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">Standard500ErrorResponse:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">An</span> <span class="string">unexpected</span> <span class="string">error</span> <span class="string">occured.</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/definitions/Error"</span></span><br><span class="line">  <span class="attr">PersonDoesNotExistResponse:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Person</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exist.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">username:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">    <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">pageSize:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">  <span class="attr">pageNumber:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-1-路径参数只定义一次"><a href="#3-3-1-路径参数只定义一次" class="headerlink" title="3.3.1 路径参数只定义一次"></a>3.3.1 路径参数只定义一次</h4><p>如果我们现在想要删除一个用户的信息，就需要增加一个 <em>delete /persons/{username}</em> 的操作，可以这样：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">for</span> <span class="string">its</span> <span class="string">username.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/PersonDoesNotExistResponse"</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line">    <span class="attr">delete:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Deletes</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Delete</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">identified</span> <span class="string">via</span> <span class="string">its</span> <span class="string">username</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">204:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Person</span> <span class="string">successfully</span> <span class="string">deleted.</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/PersonDoesNotExistResponse"</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br></pre></td></tr></table></figure>

<p>但是上面两次对参数 <em>username</em> 的定义，却让人有点难受。好消息是我们可以定义<a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#pathItemObject" target="_blank" rel="noopener"><code>路径</code>级别的参数</a>（之前都是定义在操作级别。）</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">        <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">for</span> <span class="string">its</span> <span class="string">username.</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/PersonDoesNotExistResponse"</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br><span class="line">    <span class="attr">delete:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Deletes</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Delete</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">identified</span> <span class="string">via</span> <span class="string">its</span> <span class="string">username</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">204:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Person</span> <span class="string">successfully</span> <span class="string">deleted.</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/PersonDoesNotExistResponse"</span></span><br><span class="line">        <span class="attr">500:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-2-定义可重用的参数"><a href="#3-3-2-定义可重用的参数" class="headerlink" title="3.3.2 定义可重用的参数"></a>3.3.2 定义可重用的参数</h4><p>如果我们想根据用户名查找该用户的朋友圈，可以添加一个 <em>get /persons/{username}/friends</em> 的操作。根据前面所学的内容，第一反应应该这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/persons/&#123;username&#125;/friends:</span></span><br><span class="line">  <span class="attr">parameters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">      <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">      <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">get:</span></span><br><span class="line">    <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person's</span> <span class="string">friends</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">       <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">       <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">       <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">       <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">       <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">       <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">200:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">A</span> <span class="string">person's</span> <span class="string">friends</span> <span class="string">list</span> </span><br><span class="line">        <span class="attr">schema:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">"#/definitions/Persons"</span></span><br><span class="line">      <span class="attr">404:</span></span><br><span class="line">        <span class="string">$ref:</span> <span class="string">"#/responses/PersonDoesNotExistResponse"</span></span><br><span class="line">      <span class="attr">500:</span></span><br><span class="line">        <span class="string">$ref:</span> <span class="string">"#/responses/Standard500ErrorResponse"</span></span><br></pre></td></tr></table></figure>

<p>可以看到，关于 <em>username</em> 、<em>pageSize</em> 、<em>pageNumber</em> 的定义跟前面的 <em>/person/{username}</em> 、 <em>get /persons</em> 中的定义重复。如何消除重复呢？</p>
<h5 id="3-3-2-1-定义可重用的参数"><a href="#3-3-2-1-定义可重用的参数" class="headerlink" title="3.3.2.1 定义可重用的参数"></a>3.3.2.1 定义可重用的参数</h5><p>根据3.1和3.2中的内容，我们可以参考<a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#swaggerObject" target="_blank" rel="noopener">OpenAPI规范</a>，融汇贯通。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">username:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">    <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">pageSize:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">  <span class="attr">pageNumber:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">integer</span></span><br></pre></td></tr></table></figure>

<h5 id="3-3-2-2-使用定义参数"><a href="#3-3-2-2-使用定义参数" class="headerlink" title="3.3.2.2 使用定义参数"></a>3.3.2.2 使用定义参数</h5><p>借助万能的<code>引用</code>（<em>$ref</em>），这都是小菜一碟。比如：</p>
<h6 id="3-3-2-2-1-get-persons"><a href="#3-3-2-2-1-get-persons" class="headerlink" title="3.3.2.2.1 get /persons"></a>3.3.2.2.1 get /persons</h6><p>原来：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<p>现在：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/parameters/pageSize"</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/parameters/pageNumber"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h6 id="3-3-2-2-2-get-和-delete-persons-username"><a href="#3-3-2-2-2-get-和-delete-persons-username" class="headerlink" title="3.3.2.2.2 get 和 delete /persons/{username}"></a>3.3.2.2.2 get 和 delete /persons/{username}</h6><p>原来：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">        <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<p>现在：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/parameters/username"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h6 id="3-3-2-2-3-get-persons-username-friends"><a href="#3-3-2-2-3-get-persons-username-friends" class="headerlink" title="3.3.2.2.3 get /persons/{username}/friends"></a>3.3.2.2.3 get /persons/{username}/friends</h6><p>原来：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">/persons/&#123;username&#125;/friends:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">        <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">        <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person's</span> <span class="string">friends</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">pageNumber</span></span><br><span class="line">         <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">         <span class="attr">description:</span> <span class="string">Page</span> <span class="string">number</span></span><br><span class="line">         <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<p>现在：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">/persons/&#123;username&#125;/friends:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/parameters/username"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person's</span> <span class="string">friends</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/parameters/pageSize"</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/parameters/pageNumber"</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="四、深入了解一下"><a href="#四、深入了解一下" class="headerlink" title="四、深入了解一下"></a>四、深入了解一下</h2><p>通过前面的练习，我们可以写出一篇结构清晰、内容精炼的API文档了。可是OpenAPI规范还给我们提供了更多的便利和惊喜，等着我们去了解和掌握。这一章主要介绍用于定义属性和数据模型的高级方法。</p>
<h3 id="4-1-私人定制"><a href="#4-1-私人定制" class="headerlink" title="4.1 私人定制"></a>4.1 私人定制</h3><blockquote>
<p>Primitive data types in the Swagger Specification are based on the types supported by the JSON-Schema Draft 4. Models are described using the Schema Object which is a subset of JSON Schema Draft 4. </p>
</blockquote>
<h4 id="4-1-1-字符串（Strings）长度和格式"><a href="#4-1-1-字符串（Strings）长度和格式" class="headerlink" title="4.1.1 字符串（Strings）长度和格式"></a>4.1.1 字符串（Strings）长度和格式</h4><p>当定义个字符串属性时，我们可以定制它的长度及格式：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>minLength</td>
<td>number</td>
<td>字符串最小长度</td>
</tr>
<tr>
<td>maxLength</td>
<td>number</td>
<td>字符串最大长度</td>
</tr>
<tr>
<td>pattern</td>
<td>string</td>
<td>正则表达式 ，如果你暂时还不熟悉正则表达式</td>
</tr>
</tbody></table>
<p>如果我们规定用户名是长度介于8~64，而且只能由小写字母和数字来构成，那么我们可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">username:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">pattern:</span> <span class="string">"[a-z0-9]&#123;8,64&#125;"</span></span><br><span class="line">  <span class="attr">minLength:</span> <span class="number">8</span></span><br><span class="line">  <span class="attr">maxLength:</span> <span class="number">64</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1-2-日期和时间"><a href="#4-1-2-日期和时间" class="headerlink" title="4.1.2 日期和时间"></a>4.1.2 日期和时间</h4><p>日期和时间的处理参考 RFC 3339，我们唯一要做的就是写对格式：</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>属性包含内容</th>
<th>属性示例</th>
</tr>
</thead>
<tbody><tr>
<td>date</td>
<td>ISO8601 full-date</td>
<td>2016-04-01</td>
</tr>
<tr>
<td>dateTime</td>
<td>ISO8601 date-time</td>
<td>2016-04-16T16:06:05Z</td>
</tr>
</tbody></table>
<p>如果我们在 <em>Person</em> 的定义中增加 <code>生日</code> 和 <code>上次登录时间</code> 时间戳，我们可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">dateOfBirth:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">date</span></span><br><span class="line"><span class="attr">lastTimeOnline:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">dateTime</span></span><br></pre></td></tr></table></figure>



<h4 id="4-1-3-数字类型和范围"><a href="#4-1-3-数字类型和范围" class="headerlink" title="4.1.3 数字类型和范围"></a>4.1.3 数字类型和范围</h4><p>当我们定义一个数字类型的属性时，我们可以[规定]它是一个整型、长型、浮点型或者双浮点型。</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>类型</th>
<th>格式</th>
</tr>
</thead>
<tbody><tr>
<td>integer</td>
<td>integer</td>
<td>int32</td>
</tr>
<tr>
<td>long</td>
<td>integer</td>
<td>int64</td>
</tr>
<tr>
<td>float</td>
<td>number</td>
<td>float</td>
</tr>
<tr>
<td>double</td>
<td>number</td>
<td>double</td>
</tr>
</tbody></table>
<p>和字符串一样，我们也可以定义数字属性的范围，比如：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>minimum</td>
<td>number</td>
<td>最小值</td>
</tr>
<tr>
<td>maximum</td>
<td>number</td>
<td>最大值</td>
</tr>
<tr>
<td>exclusiveMinimum</td>
<td>boolean</td>
<td>数值必须 &gt; 最小值</td>
</tr>
<tr>
<td>exclusiveMaximum</td>
<td>boolean</td>
<td>数值必须 &lt; 最大值</td>
</tr>
<tr>
<td>multipleOf</td>
<td>number</td>
<td>数值必须是multipleOf的整数倍</td>
</tr>
</tbody></table>
<p>如果我们规定 <em>pageSize</em> 必须是整数，必须 &gt; 0 且 &lt;=100，还必须是 10 的整数倍，可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">pageSize:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">  <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">int32</span></span><br><span class="line">  <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">  <span class="attr">exclusiveMinimum:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">maximum:</span> <span class="number">100</span></span><br><span class="line">  <span class="attr">exclusiveMaximum:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">multipleOf:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1-4-枚举类型"><a href="#4-1-4-枚举类型" class="headerlink" title="4.1.4 枚举类型"></a>4.1.4 枚举类型</h4><p>我们还可以定义枚举类型，比如定义 <em>Error</em> 时，我们可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">code:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">enum:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">DBERR</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">NTERR</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">UNERR</span></span><br></pre></td></tr></table></figure>

<p><em>code</em> 的值只能从三个枚举值中选择。</p>
<h4 id="4-1-5-数值的大小和唯一性"><a href="#4-1-5-数值的大小和唯一性" class="headerlink" title="4.1.5 数值的大小和唯一性"></a>4.1.5 数值的大小和唯一性</h4><p>数字的大小和唯一性通过下面这些属性来定义：</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>minItems</td>
<td>number</td>
<td>数值中的最小元素个数</td>
</tr>
<tr>
<td>maxItem</td>
<td>number</td>
<td>数值中的最大元素个数</td>
</tr>
<tr>
<td>uniqueItems</td>
<td>boolean</td>
<td>标示数组中的元素是否唯一</td>
</tr>
</tbody></table>
<p>比如我们定义一个用户数组 <em>Persons</em>，希望返回的用户信息条数介于10~100之间，而且不能有重复的用户信息，我们可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Persons:</span></span><br><span class="line">  <span class="attr">properties:</span></span><br><span class="line">    <span class="attr">items:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">      <span class="attr">minItems:</span> <span class="number">10</span></span><br><span class="line">      <span class="attr">maxItems:</span> <span class="number">100</span></span><br><span class="line">      <span class="attr">uniqueItems:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">items:</span></span><br><span class="line">        <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br></pre></td></tr></table></figure>

<h4 id="4-1-6-二进制数据"><a href="#4-1-6-二进制数据" class="headerlink" title="4.1.6 二进制数据"></a>4.1.6 二进制数据</h4><p>可以用 <em>string</em> 类型来表示二进制数据：</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>属性包含</th>
</tr>
</thead>
<tbody><tr>
<td>byte</td>
<td>Base64编码字符</td>
</tr>
<tr>
<td>binary</td>
<td>任意十进制的数据序列</td>
</tr>
</tbody></table>
<p>比如我们需要在用户信息中增加一个头像属性（<em>avatarBase64PNG</em>）用base64编码的PNG图片来表示，可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">avatarBase64PNG:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">byte</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-高级数据定义"><a href="#4-2-高级数据定义" class="headerlink" title="4.2 高级数据定义"></a>4.2 高级数据定义</h3><h4 id="4-2-1-读写操作同一定义的数据"><a href="#4-2-1-读写操作同一定义的数据" class="headerlink" title="4.2.1 读写操作同一定义的数据"></a>4.2.1 读写操作同一定义的数据</h4><p>有时候我们读取资源信息的内容会比我们写入资源信息的内容（属性）更多，这很常见。是不是意味着我们必须专门为读取资源和写入资源分别定义不同的数据模型呢？幸运的是，OpenAPI规范中提供了 <em>readOnly</em>字段来帮我们解决整问题。比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">lastTimeOnline:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">format:</span> <span class="string">dateTime</span></span><br><span class="line">  <span class="attr">readOnly:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>上面这个例子中，<code>上次在线时间</code>（<em>lastTimeOnline</em> ）是 <em>Person</em> 的一个属性，我们获取用户信息时需要这个属性。但是很明显，在创建用户时，我们不能把这个属性 <em>post</em> 到服务器。于是我们可以把它标记为 <em>readOnly</em>。</p>
<h4 id="4-2-2-组合定义确保一致性"><a href="#4-2-2-组合定义确保一致性" class="headerlink" title="4.2.2 组合定义确保一致性"></a>4.2.2 组合定义确保一致性</h4><p>一致性设计是在编写API文档时需要重点考虑的问题。比如我们在获取一组用户信息时，需要同时获取<code>页面信息</code>（</p>
<p>totalItems, totalPage, pageSize, currentPage）等，而且这些信息<strong>必须</strong>在根节点上。</p>
<p>怎么办呢？首先想到的做法就是：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">PagedPersonsV1:</span></span><br><span class="line">  <span class="attr">properties:</span></span><br><span class="line">    <span class="attr">items:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">      <span class="attr">items:</span></span><br><span class="line">        <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">    <span class="attr">totalItems:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">    <span class="attr">totalPages:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">    <span class="attr">pageSize:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">    <span class="attr">currentPage:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">integer</span></span><br></pre></td></tr></table></figure>

<p>如果其他API操作也需要这些<code>页面信息</code>，那就意味着这些属性必须一遍又一遍的定义。不仅重复体力劳动，而且还很危险：比如忘记了其中的一两个属性，或者需要添加一个新的属性进来，那就是霰弹式的修改，想想都很悲壮。</p>
<p>稍微好一点的做法，就是根据前面学习的内容，把这几个属性抽取出来，建立一个 <em>Paging</em> 模型，“一处定义、处处使用”：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">PagedPersonsV2:</span></span><br><span class="line">  <span class="attr">properties:</span></span><br><span class="line">    <span class="attr">items:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">      <span class="attr">items:</span></span><br><span class="line">        <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">    <span class="attr">paging:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/definitions/Paging"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">Paging:</span></span><br><span class="line">  <span class="attr">properties:</span></span><br><span class="line">    <span class="attr">totalItems:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">    <span class="attr">totalPages:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">    <span class="attr">pageSize:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">    <span class="attr">currentPage:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">integer</span></span><br></pre></td></tr></table></figure>

<p><strong>但是</strong>，页面属性都不再位于 <strong>根节点</strong>！与我们前面设定的要求不一样了。怎么破？</p>
<p><a href="https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#composition-and-inheritance-polymorphism" target="_blank" rel="noopener">JSON Schema v4 property</a>中定义的<code>allOf</code>，能帮我们解围：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">PagedPersons:</span></span><br><span class="line">  <span class="attr">allOf:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/definitions/Persons"</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/definitions/Paging"</span></span><br></pre></td></tr></table></figure>

<p>上面这个例子表示，<em>PagedPersons</em> 根节点下，具有将 <em>Persons</em> 和 <em>Paging</em> <strong>展开</strong> 后的全部属性。</p>
<p><code>allOf</code>同样可以使用行内的数据定义，比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">PagedCollectingItems:</span></span><br><span class="line">  <span class="attr">allOf:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">properties:</span></span><br><span class="line">        <span class="attr">items:</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">          <span class="attr">minItems:</span> <span class="number">10</span></span><br><span class="line">          <span class="attr">maxItems:</span> <span class="number">100</span></span><br><span class="line">          <span class="attr">uniqueItems:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">items:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/CollectingItem"</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">"#/definitions/Paging"</span></span><br></pre></td></tr></table></figure>

<h4 id="4-2-3-数据模型的继承（TODO）"><a href="#4-2-3-数据模型的继承（TODO）" class="headerlink" title="4.2.3 数据模型的继承（TODO）"></a>4.2.3 数据模型的继承（TODO）</h4><p>目前各工具支持程度不高，待续</p>
<hr>
<h2 id="五、-输入输出模型"><a href="#五、-输入输出模型" class="headerlink" title="五、 输入输出模型"></a>五、 输入输出模型</h2><p>这一章主要介绍如何定义高度精确化的参数和响应消息等。</p>
<h3 id="5-1-高级参数定义"><a href="#5-1-高级参数定义" class="headerlink" title="5.1 高级参数定义"></a>5.1 高级参数定义</h3><h4 id="5-1-1-必带参数和可选参数"><a href="#5-1-1-必带参数和可选参数" class="headerlink" title="5.1.1 必带参数和可选参数"></a>5.1.1 必带参数和可选参数</h4><p>我们已经知道使用关键字<code>required</code>来定义一个必带参数。</p>
<h5 id="5-1-1-1-定义必带参数和可选参数"><a href="#5-1-1-1-定义必带参数和可选参数" class="headerlink" title="5.1.1.1 定义必带参数和可选参数"></a>5.1.1.1 定义必带参数和可选参数</h5><p>在一个参数中，<code>required</code>是一个 <code>boolean</code> 型的可选值。它的默认值是 <em>false</em> 。</p>
<p>比如在某个操作中，<em>username</em> 是必填参数：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">username:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">    <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<h5 id="5-1-1-2-定义必带属性和可选属性"><a href="#5-1-1-2-定义必带属性和可选属性" class="headerlink" title="5.1.1.2 定义必带属性和可选属性"></a>5.1.1.2 定义必带属性和可选属性</h5><p>根据定义，<code>required</code>是一个字符串列表，列表中包含各必带参数名。如果某个参数在这张列表中找不到，那就说明它不是必带参数。如果没有定义<code>required</code>，就说明所有参数都是可选。如果<code>required</code>定义在一个HTTP请求上，这说明所有的请求参数都是必填。</p>
<p>在 <em>POST 、persons</em> 中有 <em>Person</em> 的定义，在这里 <em>username</em> 这个属性是必带的，我们可以指定它为<code>required</code>，其他非必带字段则不指定：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="attr">Person:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">pattern:</span> <span class="string">'[a-z0-9]&#123;8,64&#125;'</span></span><br><span class="line">        <span class="attr">minLength:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">maxLength:</span> <span class="number">64</span></span><br><span class="line">      <span class="attr">dateOfBirth:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">date</span></span><br><span class="line">      <span class="attr">lastTimeOnline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">date-time</span></span><br><span class="line">        <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">avatarBase64PNG:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">byte</span></span><br><span class="line">        <span class="attr">default:</span> <span class="string">data:image/png;base64,i……</span></span><br><span class="line">      <span class="attr">spokenLanguages:</span></span><br><span class="line">        <span class="string">$ref:</span> <span class="string">'#/definitions/SpokenLanguages'</span></span><br></pre></td></tr></table></figure>

<h4 id="5-1-2-带默认值的参数"><a href="#5-1-2-带默认值的参数" class="headerlink" title="5.1.2 带默认值的参数"></a>5.1.2 带默认值的参数</h4><p>通过关键字<code>default</code>，我们可以定义一个参数的默认值。当这个参数不可得（请求未带或者服务器未返回）时，这个参数就取默认值。因此设定了某个参数的默认值后，它是否<code>required</code>就没意义了。</p>
<h5 id="5-1-2-1-定义参数的默认值"><a href="#5-1-2-1-定义参数的默认值" class="headerlink" title="5.1.2.1 定义参数的默认值"></a>5.1.2.1 定义参数的默认值</h5><p>我们定义参数 <em>pageSize</em> 的默认值为 <em>20</em> ，那么如果请求时没有填写 <em>pageSize</em> ，服务器也会默认返回 <em>20</em> 个元素。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">pageSize:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">    <span class="attr">format:</span> <span class="string">int32</span></span><br><span class="line">    <span class="attr">minimum:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">exclusiveMinimum:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">maximum:</span> <span class="number">100</span></span><br><span class="line">    <span class="attr">exclusiveMaximum:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">multipleOf:</span> <span class="number">10</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">    <span class="attr">default:</span> <span class="number">20</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h5 id="5-1-2-2-定义属性的默认值"><a href="#5-1-2-2-定义属性的默认值" class="headerlink" title="5.1.2.2 定义属性的默认值"></a>5.1.2.2 定义属性的默认值</h5><p>我们在定义 <em>Person</em> 对象时，希望给每个用户一个默认头像，也就是要给 <em>avatarBase64PNG</em> 属性一个默认值。</p>
<p>默认头像: …</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">Person:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">pattern:</span> <span class="string">'[a-z0-9]&#123;8,64&#125;'</span></span><br><span class="line">        <span class="attr">minLength:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">maxLength:</span> <span class="number">64</span></span><br><span class="line">      <span class="attr">dateOfBirth:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">date</span></span><br><span class="line">      <span class="attr">lastTimeOnline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">date-time</span></span><br><span class="line">        <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">avatarBase64PNG:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">byte</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">default:</span> <span class="string">data:image/png;base64,iVBORw0KGgoAAAANSUhEUgA……rkJggg==</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">      <span class="attr">spokenLanguages:</span></span><br><span class="line">        <span class="string">$ref:</span> <span class="string">'#/definitions/SpokenLanguages'</span></span><br></pre></td></tr></table></figure>

<h4 id="5-1-3-带空值的参数"><a href="#5-1-3-带空值的参数" class="headerlink" title="5.1.3 带空值的参数"></a>5.1.3 带空值的参数</h4><p>在 <em>GET /persons</em> 时，如果我们想添加一个参数来过滤“是否通过实名认证”的用户，应该怎么做呢？首先想到的是这样：<em>GET /persons?page=2&amp;includeVerifiedUsers=true</em> ，问题是 <em>includeVerifiedUsers</em> 语义已经如此清晰，而让 “=true”显得很多余。我们能不能直接用：<em>GET /persons?page=2&amp;includeVerifiedUsers</em> 呢？</p>
<p>要做到这种写法，我们需要一个关键字 <code>allowEmptyValue</code>。我们定义 <em>includeVerifiedUsers</em> 时允许它为空。那么如果我们请求 <em>GET /persons?page=2&amp;includeVerifiedUsers</em> 则表示需要过滤“实名认证”用户，如果我们直接请求 <em>GET /persons?page=2</em> 则表示不过滤：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">includeNonVerifiedUsers:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">includeNonVerifiedUsers</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">boolean</span></span><br><span class="line">    <span class="attr">default:</span> <span class="literal">false</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">    <span class="attr">allowEmptyValue:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="5-1-4-参数组"><a href="#5-1-4-参数组" class="headerlink" title="5.1.4 参数组"></a>5.1.4 参数组</h4><p>设计API的时候，我们经常会遇到在 <em>GET</em> 请求中需要携带一组请求参数的情况。如何在API文档章呈现呢？很简单，我们只需要设定<code>参数类型（type）</code> 为<code>array</code>，并选择合适的 <code>组合格式（collectionFormat）</code>就行了。</p>
<table>
<thead>
<tr>
<th>COLLECTIONFORMAT</th>
<th>描述</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>csv (default value)</td>
<td>Comma separated values（逗号分隔） <code>foo,bar</code></td>
<td></td>
</tr>
<tr>
<td>ssv</td>
<td>Space separated values（空格分隔） <code>foo bar</code></td>
<td></td>
</tr>
<tr>
<td>tsv</td>
<td>Tab separated values（反斜杠分隔） <code>foo\tbar</code></td>
<td></td>
</tr>
<tr>
<td>pipes</td>
<td>Pipes separated values（竖线分隔） `foo\</td>
<td>bar`</td>
</tr>
<tr>
<td>multi</td>
<td>单属性可以取多个值，比如 <code>foo=bar&amp;foo=baz</code>. 只适用于查询参数和表单参数。</td>
<td></td>
</tr>
</tbody></table>
<p>比如我们想根据多种参数（<em>username</em> ， <em>firstname</em> ， <em>lastname</em> ， <em>lastTimeOnline</em> ）等来对 <em>Person</em> 进行带排序的查询。我们需要一个这样的API请求： <em>GET /persons?sort=-lastTimeOnline|+firtname|+lastname</em> 。用于排序的参数是 <em>sort</em> ，<code>+</code>表示升序，<code>-</code>表示降序。</p>
<p>相应的API文档，可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">sortPersons:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">sort</span></span><br><span class="line">  <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">  <span class="attr">uniqueItems:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">minItems:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">maxItems:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">collectionFormat:</span> <span class="string">pipes</span></span><br><span class="line">  <span class="attr">items:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">    <span class="attr">pattern:</span> <span class="string">'[-+](username|lastTimeOnline|firstname|lastname)'</span></span><br></pre></td></tr></table></figure>

<p>现在我们就能搞定 <em>GET /persons?sort=-lastTimeOnline|+firtname|+lastname</em> 这种请求了。当然，我们还可以指定排序的默认值，锦上添花。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">sortPersons:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">sort</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">    <span class="attr">uniqueItems:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">minItems:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">maxItems:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">collectionFormat:</span> <span class="string">pipes</span></span><br><span class="line">    <span class="attr">items:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">pattern:</span> <span class="string">'[-+](username|lastTimeOnline|firstname|lastname)'</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">-lastTimeOnline</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">+username</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="5-1-5-消息头（Header）参数"><a href="#5-1-5-消息头（Header）参数" class="headerlink" title="5.1.5 消息头（Header）参数"></a>5.1.5 消息头（Header）参数</h4><p>参数，按照位置来分，不仅仅包含路径参数、请求参数和消息体参数，还包括消息头参数和表单参数等。比如我们可以在HTTP请求的消息头上加一个 <em>User-Agent</em> （用于跟踪、调试或者其他），可以这样定义它：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">userAgent:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">User-Agent</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">in:</span> <span class="string">header</span></span><br><span class="line">  <span class="attr">required:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>然后像使用其他参数一样使用它：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br></pre></td></tr></table></figure>

<h4 id="5-1-6-表单参数"><a href="#5-1-6-表单参数" class="headerlink" title="5.1.6 表单参数"></a>5.1.6 表单参数</h4><p>有些 <em>js-less-browser</em> 的老浏览器不支持 <em>POST</em> JSON数据，比如在创建用户时，只能够以这样个格式请求：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST /js-less-persons</span><br><span class="line"></span><br><span class="line">username=apihandyman&amp;firstname=API&amp;lastname=Handyman</span><br></pre></td></tr></table></figure>

<p>没有问题，丝袜哥可以搞定。我们只需要把各个属性的<code>in</code>关键字定义为<code>formData</code>，然后设置<code>consumes</code>的媒体类型为<code>application/x-www-form-urlencoded</code>即可。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">For</span> <span class="string">JS-less</span> <span class="string">partners</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="attr">consumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">application/x-www-form-urlencoded</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">      <span class="attr">produces:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">text/html</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">formData</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">pattern:</span> <span class="string">'[a-z0-9]&#123;8,64&#125;'</span></span><br><span class="line">          <span class="attr">minLength:</span> <span class="number">8</span></span><br><span class="line">          <span class="attr">maxLength:</span> <span class="number">64</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">firstname</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">formData</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">lastname</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">formData</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">dateOfBirth</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">formData</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">format:</span> <span class="string">date</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">'204':</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Person</span> <span class="string">succesfully</span> <span class="string">created.</span></span><br></pre></td></tr></table></figure>

<h4 id="5-1-7-文件参数"><a href="#5-1-7-文件参数" class="headerlink" title="5.1.7 文件参数"></a>5.1.7 文件参数</h4><p>当我们要处理一个请求，输入类型是 <strong>文件</strong> 时，我们需要：</p>
<ul>
<li>使用 <em>multipart/form-data</em> 媒体类型；</li>
<li>设置参数的 <code>in</code>关键字为 <em>formData</em>；</li>
<li>设置参数的<code>类型（type）</code>为 <em>file</em>。</li>
</ul>
<p>比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/images:</span></span><br><span class="line">  <span class="attr">parameters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br><span class="line">  <span class="attr">post:</span></span><br><span class="line">    <span class="attr">summary:</span> <span class="string">Uploads</span> <span class="string">an</span> <span class="string">image</span></span><br><span class="line">    <span class="attr">consumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">multipart/form-data</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">image</span></span><br><span class="line">        <span class="attr">in:</span> <span class="string">formData</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">file</span></span><br><span class="line">    <span class="attr">responses:</span></span><br><span class="line">      <span class="attr">'200':</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">Image's</span> <span class="string">ID</span></span><br><span class="line">        <span class="attr">schema:</span></span><br><span class="line">          <span class="attr">properties:</span></span><br><span class="line">            <span class="attr">imageId:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<p>有时候我们想限定输入文件的类型（后缀），很不幸的是，根据现在V2.0的规范暂时还做不到☹</p>
<blockquote>
<p>The spec doesn’t allow specifying a content type for specific form data parameters. It’s a limitation of the spec. <em>Ron Ratovsky comment in Swagger UI 609 issue</em></p>
</blockquote>
<h4 id="5-1-8-参数的媒体类型"><a href="#5-1-8-参数的媒体类型" class="headerlink" title="5.1.8 参数的媒体类型"></a>5.1.8 参数的媒体类型</h4><p>一个API可以消费各种不同的媒体类型，比如说最常见的是 <em>application/json</em> 类型的数据，当然这不是API唯一支持的类型。我们可以在<strong>文档的根节点</strong> 或者一个<strong>操作的根节点</strong> 下添加关键字 <code>consumes</code>，来定义这个操作能够消费的媒体类型。</p>
<p>比如我们的API全部都接受JSON和YAML的数据，那我们可以在文档的根节点下添加：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">consumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">application/json</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">application/x-yaml</span></span><br></pre></td></tr></table></figure>

<p>如果某个操作（比如上传图片的操作）很特殊，它可以通过自己添加 <code>consumes</code>来覆盖全局设置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">/images:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Uploads</span> <span class="string">an</span> <span class="string">image</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="attr">consumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">multipart/form-data</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">image</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">formData</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">file</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">'200':</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Image's</span> <span class="string">ID</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="attr">properties:</span></span><br><span class="line">              <span class="attr">imageId:</span></span><br><span class="line">                <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-高级响应消息定义"><a href="#5-2-高级响应消息定义" class="headerlink" title="5.2 高级响应消息定义"></a>5.2 高级响应消息定义</h3><h4 id="5-2-1-不带消息体的响应消息"><a href="#5-2-1-不带消息体的响应消息" class="headerlink" title="5.2.1 不带消息体的响应消息"></a>5.2.1 不带消息体的响应消息</h4><p>不带消息体的响应很常见，比如HTTP <em>204</em> 状态响应本身就表示服务器返回不带任何消息内容的成功消息。</p>
<p>要定义一个不带消息体的响应很简单，我们只需要写响应状态和描述就行了：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">'#/definitions/Person'</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">'204':</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Person</span> <span class="string">succesfully</span> <span class="string">created.</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="5-2-2-响应消息中的必带参数和可选参数"><a href="#5-2-2-响应消息中的必带参数和可选参数" class="headerlink" title="5.2.2 响应消息中的必带参数和可选参数"></a>5.2.2 响应消息中的必带参数和可选参数</h4><p>与请求消息中类似，我们使用<code>required</code>参数来表示，比如请求一个用户信息时， 服务器必须返回<em>username</em>，可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">Person:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">pattern:</span> <span class="string">'[a-z0-9]&#123;8,64&#125;'</span></span><br><span class="line">        <span class="attr">minLength:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">maxLength:</span> <span class="number">64</span></span><br><span class="line">      <span class="attr">dateOfBirth:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">date</span></span><br><span class="line">      <span class="attr">lastTimeOnline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">date-time</span></span><br><span class="line">        <span class="attr">readOnly:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="5-2-3-响应消息头"><a href="#5-2-3-响应消息头" class="headerlink" title="5.2.3 响应消息头"></a>5.2.3 响应消息头</h4><p>API的返回结果不仅仅体现下HTTP状态和响应消息体，还可以在响应消息头上做文章。比如我们可以限定一个API的使用次数和使用时间段，在响应消息头中，增加一个属性<em>X-Rate-Limit-Remaining</em> 来表示API可调用的剩余次数，增加另一个属性 <em>X-Rate-Limit-Reset</em> 来表示API的有效截止时间。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">'#/definitions/Person'</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">'204':</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Person</span> <span class="string">succesfully</span> <span class="string">created.</span></span><br><span class="line">          <span class="attr">headers:</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">            <span class="attr">X-Rate-Limit-Remaining:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">X-Rate-Limit-Reset:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">format:</span> <span class="string">date-time</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<p>美中不足的是，对于这种响应消息头的修改，目前2.0规范暂时还不支持“一次定义、处处使用”☹</p>
<h4 id="5-2-4-默认响应消息"><a href="#5-2-4-默认响应消息" class="headerlink" title="5.2.4 默认响应消息"></a>5.2.4 默认响应消息</h4><p>我们在定义响应消息时，通常会列举不同的HTTP状态结果。如果有些状态不在我们API文档的定义范围（比如服务器需要返回 <em>993</em> 的状态），该怎么处理呢？这时需要通过关键字<code>default</code>来定义一个默认响应消息，用于各种<strong>定义之外</strong>的状态响应，比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">    <span class="attr">delete:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Deletes</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Delete</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">identified</span> <span class="string">via</span> <span class="string">its</span> <span class="string">username</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">'204':</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Person</span> <span class="string">successfully</span> <span class="string">deleted.</span></span><br><span class="line">          <span class="attr">headers:</span></span><br><span class="line">            <span class="attr">X-Rate-Limit-Remaining:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">X-Rate-Limit-Reset:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">format:</span> <span class="string">date-time</span></span><br><span class="line">        <span class="attr">'404':</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">'#/responses/PersonDoesNotExistResponse'</span></span><br><span class="line">        <span class="attr">'500':</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">'#/responses/Standard500ErrorResponse'</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">default:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">'#/responses/TotallyUnexpectedResponse'</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<p>目前这个配置也不支持“一次定义，处处使用” 。☹</p>
<h4 id="5-2-5-响应消息的媒体类型"><a href="#5-2-5-响应消息的媒体类型" class="headerlink" title="5.2.5 响应消息的媒体类型"></a>5.2.5 响应消息的媒体类型</h4><p>与请求消息一样，我们也可以定义响应消息所支持的媒体类型，不同的是我们要用到关键字 <code>produces</code>（与请求消息中的<code>consumes</code>相对，由此可见，API文档描述的主体是<strong>服务提供者</strong>）。</p>
<p>比如，我们可以在文档的根路径下全局设置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">produces:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">application/json</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">application/x-yaml</span></span><br></pre></td></tr></table></figure>

<p>也可以在某个操作的根路径下覆盖设置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">/images/&#123;imageId&#125;:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">an</span> <span class="string">image</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">imageId</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="attr">produces:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">image/png</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">image/gif</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">image/jpeg</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">application/json</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">application/x-yaml</span></span><br><span class="line"><span class="comment"># END ############################################################################ </span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">'200':</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">image</span></span><br><span class="line">          <span class="attr">headers:</span></span><br><span class="line">            <span class="attr">X-Rate-Limit-Remaining:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">X-Rate-Limit-Reset:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">format:</span> <span class="string">date-time</span></span><br><span class="line">        <span class="attr">'404':</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">Image</span> <span class="string">do</span> <span class="string">not</span> <span class="string">exists</span></span><br><span class="line">          <span class="attr">headers:</span></span><br><span class="line">            <span class="attr">X-Rate-Limit-Remaining:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">            <span class="attr">X-Rate-Limit-Reset:</span></span><br><span class="line">              <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">              <span class="attr">format:</span> <span class="string">date-time</span></span><br><span class="line">        <span class="attr">'500':</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">'#/responses/Standard500ErrorResponse'</span></span><br><span class="line">        <span class="attr">default:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">'#/responses/TotallyUnexpectedResponse'</span></span><br></pre></td></tr></table></figure>

<h3 id="5-3-定义某个参数只存在于响应消息中"><a href="#5-3-定义某个参数只存在于响应消息中" class="headerlink" title="5.3 定义某个参数只存在于响应消息中"></a>5.3 定义某个参数只存在于响应消息中</h3><p>如前章节4.2.1中已经提到的，定义一个对象，其中某个属性我们只希望在响应消息中携带，而不希望在请求消息中携带，应该用<code>readOnly</code>关键字来表示。考虑到内容的完整性，这里再介绍一下。</p>
<p>比如 <em>Person</em> 对象中的 <em>lastTimeOnline</em> 这个属性，注册用户时我们不需要填写，但是在获取用户信息时，需要提供给服务消费者：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">Person:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">pattern:</span> <span class="string">'[a-z0-9]&#123;8,64&#125;'</span></span><br><span class="line">        <span class="attr">minLength:</span> <span class="number">8</span></span><br><span class="line">        <span class="attr">maxLength:</span> <span class="number">64</span></span><br><span class="line">      <span class="attr">dateOfBirth:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">date</span></span><br><span class="line">      <span class="attr">lastTimeOnline:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">date-time</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="六、-不要让API裸奔"><a href="#六、-不要让API裸奔" class="headerlink" title="六、 不要让API裸奔"></a>六、 不要让API裸奔</h2><p>这一章主要介绍API文档中如何描述安全相关的内容。</p>
<h3 id="6-1-定义安全"><a href="#6-1-定义安全" class="headerlink" title="6.1 定义安全"></a>6.1 定义安全</h3><p>安全相关内容的定义一般放在API文档根目录下的<code>securityDefinition</code> 中，它包括一组具体的命名安全项，每一个命名安全定义可能包括下面三种安全类型之一：<em>basic<em>，</em>apiKey</em> ，<em>oauth2</em>。</p>
<h4 id="6-1-1-基础鉴权（Basic-Authentication）"><a href="#6-1-1-基础鉴权（Basic-Authentication）" class="headerlink" title="6.1.1 基础鉴权（Basic Authentication）"></a>6.1.1 基础鉴权（Basic Authentication）</h4><p>要定义一个基础（<em>basic*） 鉴权，我们只需要将<code>type</code>设置为 *basic</em> 即可：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">securityDefinitions:</span></span><br><span class="line">  <span class="attr">UserSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">basic</span></span><br><span class="line">  <span class="attr">AdminSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">basic</span></span><br><span class="line">  <span class="attr">MediaSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">basic</span></span><br></pre></td></tr></table></figure>

<p>这个例子中，我们定义了三种安全说明（<em>UserSecurity</em>，<em>AdminSecurity</em>， <em>MediaSecurity</em>），都属于基础鉴权。</p>
<h4 id="6-1-2-API秘钥鉴权（API-Key）"><a href="#6-1-2-API秘钥鉴权（API-Key）" class="headerlink" title="6.1.2 API秘钥鉴权（API Key）"></a>6.1.2 API秘钥鉴权（API Key）</h4><p>要定义一个API秘钥鉴权，我们需要：</p>
<ul>
<li>设置<code>type</code>为 <em>apiKey</em></li>
<li>通过关键字<code>in</code>指示api秘钥所在位置。通常api秘钥会放在消息头、请求参数或者消息体中</li>
<li>给安全项命个名字</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">securityDefinitions:</span></span><br><span class="line">  <span class="attr">UserSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">apiKey</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">header</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">SIMPLE-API-KEY</span></span><br><span class="line">  <span class="attr">AdminSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">apiKey</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">header</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ADMIN-API-KEY</span></span><br><span class="line">  <span class="attr">MediaSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">apiKey</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">MEDIA-API-KEY</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中,我们定义了三个<code>apiKey</code>类型的安全项：</p>
<ul>
<li><em>UserSecurity</em> 定义了一个名为<em>SIMPLE-API-KEY</em> 的参数在消息头（header）</li>
<li><em>AdminSecurity</em> 定义了一个名为 <em>ADMIN-API-KEY</em> 的参数在消息头 （header）</li>
<li><em>MediaSecurity</em> 定义了一个名为<em>MEDIA-API-KEY</em>的参数在请求参数中</li>
</ul>
<h4 id="6-1-3-Oauth2鉴权"><a href="#6-1-3-Oauth2鉴权" class="headerlink" title="6.1.3 Oauth2鉴权"></a>6.1.3 Oauth2鉴权</h4><h5 id="6-1-3-1-流程（Flow）和URL"><a href="#6-1-3-1-流程（Flow）和URL" class="headerlink" title="6.1.3.1 流程（Flow）和URL"></a>6.1.3.1 流程（Flow）和URL</h5><p>当我们定义个 <em>Oauth2</em> 类型的安全项上，我们通常会定义<em>Oauth2</em> 的流程（flow）和并根据选定的流程配置相应的<code>鉴权地址（authorizationUrl）</code>和/或<code>令牌地址（tokenUrl）</code>。</p>
<table>
<thead>
<tr>
<th>流程</th>
<th>所需要的URL</th>
</tr>
</thead>
<tbody><tr>
<td>implicit</td>
<td>authorizationUrl（鉴权地址）</td>
</tr>
<tr>
<td>password</td>
<td>tokenUrl（令牌地址）</td>
</tr>
<tr>
<td>application</td>
<td>tokenUrl</td>
</tr>
<tr>
<td>accessCode</td>
<td>authorizationUrl and tokenUrl</td>
</tr>
</tbody></table>
<p>比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">securityDefinitions:</span></span><br><span class="line">  <span class="attr">OauthSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">oauth2</span></span><br><span class="line">    <span class="attr">flow:</span> <span class="string">accessCode</span></span><br><span class="line">    <span class="attr">authorizationUrl:</span> <span class="string">'https://oauth.simple.api/authorization'</span></span><br><span class="line">    <span class="attr">tokenUrl:</span> <span class="string">'https://oauth.simple.api/token'</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，我们定义了一个 <em>Oauth2</em> 的安全项，配置的流程是 <em>accessCode</em> 方式，同时配置了鉴权地址和令牌地址。</p>
<h5 id="6-1-3-2-作用范围（scope）"><a href="#6-1-3-2-作用范围（scope）" class="headerlink" title="6.1.3.2 作用范围（scope）"></a>6.1.3.2 作用范围（scope）</h5><p>我们借助关键字<code>scopes</code>并通过哈希键值对来还可以配置 <em>Oauth2</em> 安全项的作用范围（scope），键值对的<strong>键</strong>表示作用范围名称；<strong>值</strong>是它的相关描述，比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">securityDefinitions:</span></span><br><span class="line">  <span class="attr">OauthSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">oauth2</span></span><br><span class="line">    <span class="attr">flow:</span> <span class="string">accessCode</span></span><br><span class="line">    <span class="attr">authorizationUrl:</span> <span class="string">'https://oauth.simple.api/authorization'</span></span><br><span class="line">    <span class="attr">tokenUrl:</span> <span class="string">'https://oauth.simple.api/token'</span></span><br><span class="line">    <span class="attr">scopes:</span></span><br><span class="line">      <span class="attr">admin:</span> <span class="string">Admin</span> <span class="string">scope</span></span><br><span class="line">      <span class="attr">user:</span> <span class="string">User</span> <span class="string">scope</span></span><br><span class="line">      <span class="attr">media:</span> <span class="string">Media</span> <span class="string">scope</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，我们给 <em>OauthSecurity</em> 安全项添加了三个作用范围（<em>admin</em> ，<em>user</em> ，<em>media</em>）。</p>
<h3 id="6-2-使用安全定义"><a href="#6-2-使用安全定义" class="headerlink" title="6.2 使用安全定义"></a>6.2 使用安全定义</h3><p>现在我们已经在<em>securityDefinition</em> 中定义好了安全项，现在我们可以将将它们应用到文档中了。使用的时候，我们通过<code>security</code>关键字，把安全项添加进去。</p>
<h4 id="6-2-1-基础鉴权"><a href="#6-2-1-基础鉴权" class="headerlink" title="6.2.1 基础鉴权"></a>6.2.1 基础鉴权</h4><h5 id="6-2-1-1-API级别"><a href="#6-2-1-1-API级别" class="headerlink" title="6.2.1.1 API级别"></a>6.2.1.1 API级别</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">securityDefinitions:</span></span><br><span class="line">  <span class="attr">UserSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">basic</span></span><br><span class="line">  <span class="attr">AdminSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">basic</span></span><br><span class="line">  <span class="attr">MediaSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">basic</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">UserSecurity:</span> <span class="string">[]</span> </span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，我们在API文档的根路径下直接使用了安全项 <em>UserSecurity</em>，它的作用范围是整个API文档。</p>
<h5 id="6-2-1-2-操作级别"><a href="#6-2-1-2-操作级别" class="headerlink" title="6.2.1.2 操作级别"></a>6.2.1.2 操作级别</h5><p>比如我们在添加或者修改用户信息时，需要进行管理员鉴权，可以在 <em>POST /persons</em> 操作中增加安全项：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="attr">security:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">AdminSecurity:</span> <span class="string">[]</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<p>而在上传图片时，需要进行媒体操作鉴权，可以在 <em>POST /images</em> 操作中增加安全项：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">/images:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Uploads</span> <span class="string">an</span> <span class="string">image</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="attr">security:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">MediaSecurity:</span> <span class="string">[]</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="6-2-2-API秘钥鉴权"><a href="#6-2-2-API秘钥鉴权" class="headerlink" title="6.2.2 API秘钥鉴权"></a>6.2.2 API秘钥鉴权</h4><p>使用方式和基础鉴权一样，可以在API级别和操作级别使用：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">securityDefinitions:</span></span><br><span class="line">  <span class="attr">UserSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">apiKey</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">header</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">SIMPLE-API-KEY</span></span><br><span class="line">  <span class="attr">AdminSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">apiKey</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">header</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">ADMIN-API-KEY</span></span><br><span class="line">  <span class="attr">MediaSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">apiKey</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">media-api-key</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">UserSecurity:</span> <span class="string">[]</span> </span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">      <span class="attr">security:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">AdminSecurity:</span> <span class="string">[]</span></span><br></pre></td></tr></table></figure>

<h4 id="6-2-3-Oauth2鉴权"><a href="#6-2-3-Oauth2鉴权" class="headerlink" title="6.2.3 Oauth2鉴权"></a>6.2.3 Oauth2鉴权</h4><p><em>Oauth2</em> 鉴权的使用和上面的两种鉴权方式基本相同，不同之处在于我们可以指定它的哪一个作用范围（scope）。</p>
<p>比如API级别的鉴权：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">securityDefinitions:</span></span><br><span class="line">  <span class="attr">OauthSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">oauth2</span></span><br><span class="line">    <span class="attr">flow:</span> <span class="string">accessCode</span></span><br><span class="line">    <span class="attr">authorizationUrl:</span> <span class="string">'https://oauth.simple.api/authorization'</span></span><br><span class="line">    <span class="attr">tokenUrl:</span> <span class="string">'https://oauth.simple.api/token'</span></span><br><span class="line">    <span class="attr">scopes:</span></span><br><span class="line">      <span class="attr">admin:</span> <span class="string">Admin</span> <span class="string">scope</span></span><br><span class="line">      <span class="attr">user:</span> <span class="string">User</span> <span class="string">scope</span></span><br><span class="line">      <span class="attr">media:</span> <span class="string">Media</span> <span class="string">scope</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">OauthSecurity:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">user</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br></pre></td></tr></table></figure>

<p>操作级别的鉴权：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post:</span></span><br><span class="line">  <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">OauthSecurity:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">admin</span></span><br></pre></td></tr></table></figure>

<p>在这个例子中，作用范围 <em>admin</em> 将覆盖全局配置的作用范围 <em>user</em> 。</p>
<h3 id="6-3-使用多种安全配置"><a href="#6-3-使用多种安全配置" class="headerlink" title="6.3 使用多种安全配置"></a>6.3 使用多种安全配置</h3><p>OpenAPI规范并没有限定我们只能使用一种安全项。下面的例子将展示如何使用多种安全配置。</p>
<h4 id="6-3-1-安全定义"><a href="#6-3-1-安全定义" class="headerlink" title="6.3.1 安全定义"></a>6.3.1 安全定义</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">securityDefinitions:</span></span><br><span class="line">  <span class="attr">OauthSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">oauth2</span></span><br><span class="line">    <span class="attr">flow:</span> <span class="string">accessCode</span></span><br><span class="line">    <span class="attr">authorizationUrl:</span> <span class="string">'https://oauth.simple.api/authorization'</span></span><br><span class="line">    <span class="attr">tokenUrl:</span> <span class="string">'https://oauth.simple.api/token'</span></span><br><span class="line">    <span class="attr">scopes:</span></span><br><span class="line">      <span class="attr">admin:</span> <span class="string">Admin</span> <span class="string">scope</span></span><br><span class="line">      <span class="attr">user:</span> <span class="string">User</span> <span class="string">scope</span></span><br><span class="line">  <span class="attr">MediaSecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">apiKey</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">media-api-key</span></span><br><span class="line">  <span class="attr">LegacySecurity:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">basic</span></span><br></pre></td></tr></table></figure>

<p>这个例子中，我们定义了三种鉴权方式。</p>
<h4 id="6-3-2-全局安全配置"><a href="#6-3-2-全局安全配置" class="headerlink" title="6.3.2 全局安全配置"></a>6.3.2 全局安全配置</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">security:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">OauthSecurity:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">user</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">LegacySecurity:</span> <span class="string">[]</span></span><br></pre></td></tr></table></figure>

<p>这个配置的意思是用户可以通过两种方式中的<strong>任意一种</strong>来访问我们提供的API接口。</p>
<h4 id="6-3-3-覆盖全局配置"><a href="#6-3-3-覆盖全局配置" class="headerlink" title="6.3.3 覆盖全局配置"></a>6.3.3 覆盖全局配置</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">post:</span></span><br><span class="line">  <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">Adds</span> <span class="string">a</span> <span class="string">new</span> <span class="string">person</span> <span class="string">to</span> <span class="string">the</span> <span class="string">persons</span> <span class="string">list.</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">OauthSecurity:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">admin</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">LegacySecurity:</span> <span class="string">[]</span></span><br></pre></td></tr></table></figure>

<p>在 <em>POST /persons</em> 操作中，<em>OauthSecurity</em> 的作用范围被覆写为<em>admin<em>。此时用户可以通过</em>admin</em> 的<em>Oauth2<strong>*或者</strong> *legacySecurity</em> 来鉴权使用这个操作。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/images:</span></span><br><span class="line">  <span class="attr">parameters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br><span class="line">  <span class="attr">post:</span></span><br><span class="line">    <span class="attr">summary:</span> <span class="string">Uploads</span> <span class="string">an</span> <span class="string">image</span></span><br><span class="line">    <span class="attr">security:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">MediaSecurity:</span> <span class="string">[]</span></span><br></pre></td></tr></table></figure>

<p>在 <em>POST/images</em> 操作中，用<em>MediaSecurity</em> 整体覆写了全局安全项，用户只能通过 <em>MediaSecurity</em> 鉴权使用这个操作。</p>
<hr>
<h2 id="七、-让文档的可读性更好"><a href="#七、-让文档的可读性更好" class="headerlink" title="七、 让文档的可读性更好"></a>七、 让文档的可读性更好</h2><h3 id="7-1-分类标签（Tags）"><a href="#7-1-分类标签（Tags）" class="headerlink" title="7.1 分类标签（Tags）"></a>7.1 分类标签（Tags）</h3><p>通过关键字<code>tags</code>我们可以对文档中接口进行归类，<code>tags</code>的本质是一个字符串列表。<code>tags</code>定义在文档的根路径下。</p>
<h4 id="7-1-1-单标签"><a href="#7-1-1-单标签" class="headerlink" title="7.1.1 单标签"></a>7.1.1 单标签</h4><p>比如说 <em>GET /persons</em> 属于<strong>用户（Person）</strong> 这个分类的，那么我们可以给它贴个标签：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">operationId:</span> <span class="string">searchUsers</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">      <span class="attr">tags:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Persons</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="7-1-2-多标签"><a href="#7-1-2-多标签" class="headerlink" title="7.1.2 多标签"></a>7.1.2 多标签</h4><p>一个操作也可以同时贴几个标签，比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/js-less-consumer-persons:</span></span><br><span class="line">  <span class="attr">parameters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br><span class="line">  <span class="attr">post:</span></span><br><span class="line">    <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">For</span> <span class="string">JS-less</span> <span class="string">partners</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">createUserJS</span></span><br><span class="line">    <span class="attr">deprecated:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">tags:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">JSLess</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">Persons</span></span><br></pre></td></tr></table></figure>

<p>贴上标签后，在Swagger Editor和Swagger UI中能够自动归类，我们可以按照标签来筛选接口，试试吧？</p>
<h3 id="7-2-无处不在的描述文字（Descriptions）"><a href="#7-2-无处不在的描述文字（Descriptions）" class="headerlink" title="7.2 无处不在的描述文字（Descriptions）"></a>7.2 无处不在的描述文字（Descriptions）</h3><p><code>description</code>这个属性几乎是无处不在，为了提高文档的可读性，我们应该在必要的地方都加上描述文字。</p>
<h4 id="7-2-1-安全项的描述"><a href="#7-2-1-安全项的描述" class="headerlink" title="7.2.1 安全项的描述"></a>7.2.1 安全项的描述</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">securityDefinitions:</span></span><br><span class="line">  <span class="attr">OauthSecurity:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">New</span> <span class="string">Oauth</span> <span class="string">security</span> <span class="string">system.</span> <span class="string">Do</span> <span class="string">not</span> <span class="string">use</span> <span class="string">MediaSecurity</span> <span class="string">or</span> <span class="string">LegacySecurity.</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">oauth2</span></span><br><span class="line">    <span class="attr">flow:</span> <span class="string">accessCode</span></span><br><span class="line">    <span class="attr">authorizationUrl:</span> <span class="string">'https://oauth.simple.api/authorization'</span></span><br><span class="line">    <span class="attr">tokenUrl:</span> <span class="string">'https://oauth.simple.api/token'</span></span><br><span class="line">    <span class="attr">scopes:</span></span><br><span class="line">      <span class="attr">admin:</span> <span class="string">Admin</span> <span class="string">scope</span></span><br><span class="line">      <span class="attr">user:</span> <span class="string">User</span> <span class="string">scope</span></span><br><span class="line">  <span class="attr">MediaSecurity:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Specific</span> <span class="string">media</span> <span class="string">security</span> <span class="string">for</span> <span class="string">backward</span> <span class="string">compatibility.</span> <span class="string">Use</span> <span class="string">OauthSecurity</span> <span class="string">instead.</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">apiKey</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">media-api-key</span></span><br><span class="line">  <span class="attr">LegacySecurity:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Legacy</span> <span class="string">security</span> <span class="string">system</span> <span class="string">for</span> <span class="string">backward</span> <span class="string">compatibility.</span> <span class="string">Use</span> <span class="string">OauthSecurity</span> <span class="string">instead.</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">basic</span></span><br></pre></td></tr></table></figure>

<h4 id="7-2-2-模式（Schema）的描述"><a href="#7-2-2-模式（Schema）的描述" class="headerlink" title="7.2.2 模式（Schema）的描述"></a>7.2.2 模式（Schema）的描述</h4><p>每一种模式（Schema），都会有一个标题（title）和一段描述，比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">definitions:</span></span><br><span class="line">  <span class="attr">Person:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">Human</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">A</span> <span class="string">person</span> <span class="string">which</span> <span class="string">can</span> <span class="string">be</span> <span class="string">the</span> <span class="string">user</span> <span class="string">itself</span> <span class="string">or</span> <span class="string">one</span> <span class="string">of</span> <span class="string">his</span> <span class="string">friend</span></span><br></pre></td></tr></table></figure>

<h4 id="7-2-3-属性的描述"><a href="#7-2-3-属性的描述" class="headerlink" title="7.2.3 属性的描述"></a>7.2.3 属性的描述</h4><p>比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">properties:</span></span><br><span class="line">  <span class="attr">firstName:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">first</span> <span class="string">name</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<h4 id="7-2-4-参数的描述"><a href="#7-2-4-参数的描述" class="headerlink" title="7.2.4 参数的描述"></a>7.2.4 参数的描述</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">person</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">body</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person</span> <span class="string">to</span> <span class="string">create.</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">'#/definitions/Person'</span></span><br><span class="line"><span class="attr">parameters:</span></span><br><span class="line">  <span class="attr">username:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">    <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">pageSize:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">pageSize</span></span><br><span class="line">    <span class="attr">in:</span> <span class="string">query</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Number</span> <span class="string">of</span> <span class="string">persons</span> <span class="string">returned</span></span><br></pre></td></tr></table></figure>

<h4 id="7-2-5-操作的概述（summary）、描述和操作ID（operationId）"><a href="#7-2-5-操作的概述（summary）、描述和操作ID（operationId）" class="headerlink" title="7.2.5 操作的概述（summary）、描述和操作ID（operationId）"></a>7.2.5 操作的概述（summary）、描述和操作ID（operationId）</h4><p>一个操作（Operation）通常都会包含概述和描述信息。而且我们还可以添加一个关键字<code>operationId</code>，这个关键字通常用来指示服务提供者对这个操作的<strong>处理函数</strong>的函数名。比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">some</span> <span class="string">persons</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">persons.</span> <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br><span class="line">      <span class="attr">operationId:</span> <span class="string">searchUsers</span></span><br></pre></td></tr></table></figure>

<h4 id="7-2-6-响应消息的描述"><a href="#7-2-6-响应消息的描述" class="headerlink" title="7.2.6 响应消息的描述"></a>7.2.6 响应消息的描述</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">paths:</span></span><br><span class="line">  <span class="string">/persons:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="string">……</span></span><br><span class="line">      <span class="string">……</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">'200':</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">Person</span></span><br><span class="line"><span class="attr">responses:</span></span><br><span class="line">  <span class="attr">Standard500ErrorResponse:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">An</span> <span class="string">unexpected</span> <span class="string">error</span> <span class="string">occured.</span></span><br></pre></td></tr></table></figure>

<h4 id="7-2-7-响应消息头的描述"><a href="#7-2-7-响应消息头的描述" class="headerlink" title="7.2.7 响应消息头的描述"></a>7.2.7 响应消息头的描述</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">headers:</span></span><br><span class="line">  <span class="attr">X-Rate-Limit-Remaining:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">How</span> <span class="string">many</span> <span class="string">calls</span> <span class="string">consumer</span> <span class="string">can</span> <span class="string">do</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">integer</span></span><br><span class="line">  <span class="attr">X-Rate-Limit-Reset:</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">When</span> <span class="string">rate</span> <span class="string">limit</span> <span class="string">will</span> <span class="string">be</span> <span class="string">reset</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">    <span class="attr">format:</span> <span class="string">date-time</span></span><br></pre></td></tr></table></figure>

<h4 id="7-2-8-标签的描述"><a href="#7-2-8-标签的描述" class="headerlink" title="7.2.8 标签的描述"></a>7.2.8 标签的描述</h4><p>我们在API文档的根路径下添加了<code>tags</code>的定义，对于其中的每一个标签，我们都可以添加描述信息：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tags:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Persons</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">Everything</span> <span class="string">you</span> <span class="string">need</span> <span class="string">to</span> <span class="string">handle</span> <span class="string">users</span> <span class="string">and</span> <span class="string">friends</span></span><br></pre></td></tr></table></figure>

<h3 id="7-3-在描述中使用Markdown语法"><a href="#7-3-在描述中使用Markdown语法" class="headerlink" title="7.3 在描述中使用Markdown语法"></a>7.3 在描述中使用Markdown语法</h3><p>在绝大部分的<code>description</code>中，我们可以使用GFM（Github Flavored Markdown）语法。</p>
<h4 id="7-3-1-多行描述"><a href="#7-3-1-多行描述" class="headerlink" title="7.3.1 多行描述"></a>7.3.1 多行描述</h4><p>使用符号 <code>|</code> 然后在新行中打一个tab（注意：<strong>YAML的tab是两个空格</strong> ），就可以编辑多行描述，比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'/persons/&#123;username&#125;/collecting-items'</span><span class="string">:</span></span><br><span class="line">  <span class="attr">parameters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/username'</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br><span class="line">  <span class="attr">get:</span></span><br><span class="line">    <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person's</span> <span class="string">collecting</span> <span class="string">items</span> <span class="string">list</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">|</span></span><br><span class="line">      <span class="string">Returns</span> <span class="string">a</span> <span class="string">list</span> <span class="string">containing</span> <span class="string">all</span> <span class="string">items</span> <span class="string">this</span> <span class="string">person</span> <span class="string">is</span> <span class="string">looking</span> <span class="string">for.</span>  </span><br><span class="line">      <span class="string">The</span> <span class="string">list</span> <span class="string">supports</span> <span class="string">paging.</span></span><br></pre></td></tr></table></figure>

<h4 id="7-3-2-简单使用GFM"><a href="#7-3-2-简单使用GFM" class="headerlink" title="7.3.2 简单使用GFM"></a>7.3.2 简单使用GFM</h4><p>比如我们要<strong>强调</strong>，可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">externalDocs:</span> </span><br><span class="line">  <span class="attr">description:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">**Complete**</span> <span class="string">documentation</span> <span class="string">describing</span> <span class="string">how</span> <span class="string">to</span> <span class="string">use</span> <span class="string">this</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">http://doc.simple.api/</span></span><br></pre></td></tr></table></figure>

<h4 id="7-3-3-带信息组的描述"><a href="#7-3-3-带信息组的描述" class="headerlink" title="7.3.3 带信息组的描述"></a>7.3.3 带信息组的描述</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">CollectingItem:</span></span><br><span class="line">  <span class="attr">discriminator:</span> <span class="string">itemType</span></span><br><span class="line">  <span class="attr">required:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">itemType</span></span><br><span class="line">  <span class="attr">properties:</span></span><br><span class="line">    <span class="attr">itemType:</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">|</span></span><br><span class="line">        <span class="attr">An item can be of different type:</span></span><br><span class="line"></span><br><span class="line">        <span class="string">type</span> <span class="string">|</span> <span class="string">definition</span></span><br><span class="line">        <span class="string">-----|-----------</span></span><br><span class="line">        <span class="string">Vinyl|</span> <span class="comment">#/definitions/Vinyl</span></span><br><span class="line">        <span class="string">VHS</span>  <span class="string">|</span> <span class="comment">#/definitions/VHS</span></span><br><span class="line">        <span class="string">AudioCassette</span> <span class="string">|</span> <span class="comment">#/definitions/AudioCassette</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">enum:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">AudioCassette</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">Vinyl</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">VHS</span></span><br></pre></td></tr></table></figure>

<h4 id="7-3-4-带代码的描述"><a href="#7-3-4-带代码的描述" class="headerlink" title="7.3.4 带代码的描述"></a>7.3.4 带代码的描述</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">swagger:</span> <span class="string">'2.0'</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">version:</span> <span class="number">1.1</span><span class="number">.0</span></span><br><span class="line">  <span class="attr">title:</span> <span class="string">Simple</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">A</span> <span class="string">simple</span> <span class="string">API</span> <span class="string">to</span> <span class="string">learn</span> <span class="string">how</span> <span class="string">to</span> <span class="string">write</span> <span class="string">OpenAPI</span> <span class="string">Specification.</span></span><br><span class="line">    <span class="string">This</span> <span class="string">file</span> <span class="string">uses</span> <span class="string">almost</span> <span class="string">every</span> <span class="string">single</span> <span class="string">aspect</span> <span class="string">of</span> <span class="string">the</span> <span class="string">[Open</span> <span class="string">API</span> <span class="string">Specification](https://openapis.org/).</span>  </span><br><span class="line">    <span class="string">This</span> <span class="string">API</span> <span class="string">will</span> <span class="string">use</span> <span class="string">JSON.</span>  </span><br><span class="line">    <span class="attr">JSON looks like this:</span>  </span><br><span class="line"></span><br><span class="line">    <span class="string">```JSON</span></span><br><span class="line">    <span class="string">&#123;</span></span><br><span class="line">      <span class="attr">"key":</span> <span class="string">"value"</span><span class="string">,</span></span><br><span class="line">      <span class="attr">"anotherKey":</span> <span class="string">"anotherValue"</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line"><span class="comment">### 7.4 示例数据（Examples）</span></span><br><span class="line"></span><br><span class="line"><span class="string">我们已经知道了用Schema来描述参数和属性，有的时候，用示例数据更有表现了。我们可以使用关键字`example`来给原子属性或者对象添加示例数据。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#### 7.4.1 原子属性的示例数据</span></span><br><span class="line"></span><br><span class="line"><span class="string">```YAML</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">first</span> <span class="string">name</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">example:</span> <span class="string">John</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">      <span class="attr">lastTimeOnline:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">The</span> <span class="string">last</span> <span class="string">time</span> <span class="string">this</span> <span class="string">person</span> <span class="string">was</span> <span class="string">connected</span> <span class="string">to</span> <span class="string">the</span> <span class="string">service</span> <span class="string">as</span> <span class="string">a</span> </span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">format:</span> <span class="string">date-time</span></span><br><span class="line">        <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">example:</span> <span class="number">2016</span><span class="number">-06</span><span class="string">-10T12:36:58.014Z</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="7-4-2-对象属性的示例数据"><a href="#7-4-2-对象属性的示例数据" class="headerlink" title="7.4.2 对象属性的示例数据"></a>7.4.2 对象属性的示例数据</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">Persons:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">Humans</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">A</span> <span class="string">list</span> <span class="string">of</span> <span class="string">users</span> <span class="string">or</span> <span class="string">friends</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">items</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">items:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">Array</span> <span class="string">containg</span> <span class="string">the</span> <span class="string">list</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">        <span class="attr">minItems:</span> <span class="number">10</span></span><br><span class="line">        <span class="attr">maxItems:</span> <span class="number">100</span></span><br><span class="line">        <span class="attr">uniqueItems:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">items:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">'#/definitions/Person'</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">        <span class="attr">example:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">firstname:</span> <span class="string">Robert</span></span><br><span class="line">            <span class="string">lastname":</span> <span class="string">Doe</span></span><br><span class="line">            <span class="string">username":</span> <span class="string">robdo</span></span><br><span class="line">            <span class="attr">dateOfBirth:</span> <span class="number">1970</span><span class="number">-01</span><span class="number">-28</span></span><br><span class="line">            <span class="attr">lastTimeOnline:</span> <span class="number">2016</span><span class="number">-04</span><span class="string">-10T14:36:58.014Z</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">firstname:</span> <span class="string">Jane</span></span><br><span class="line">            <span class="attr">lastname:</span> <span class="string">Doe</span></span><br><span class="line">            <span class="attr">username:</span> <span class="string">jdoe123</span></span><br><span class="line">            <span class="attr">dateOfBirth:</span> <span class="number">1980</span><span class="number">-05</span><span class="number">-12</span></span><br><span class="line">            <span class="attr">lastTimeOnline:</span> <span class="number">2016</span><span class="number">-05</span><span class="string">-12T19:23:59.014Z</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="7-4-3-定义的示例数据"><a href="#7-4-3-定义的示例数据" class="headerlink" title="7.4.3 定义的示例数据"></a>7.4.3 定义的示例数据</h4><p>跟普通属性一样，定义的对象也能添加示例数据：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">  <span class="attr">MultilingualErrorMessage:</span></span><br><span class="line">    <span class="attr">title:</span> <span class="string">MultiLingualMultiDeviceErrorMessage</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">An</span> <span class="string">multilingual</span> <span class="string">error</span> <span class="string">message</span> <span class="string">(hashmap)</span> <span class="string">with</span> <span class="string">a</span> <span class="string">long</span> <span class="string">and</span> <span class="string">a</span> <span class="string">short</span> <span class="string">description</span></span><br><span class="line">    <span class="attr">additionalProperties:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">'#/definitions/ErrorMessage'</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">defaultLanguage:</span></span><br><span class="line">        <span class="string">$ref:</span> <span class="string">'#/definitions/ErrorMessage'</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">    <span class="attr">example:</span></span><br><span class="line">      <span class="attr">defaultLanguage:</span></span><br><span class="line">        <span class="attr">longMessage:</span> <span class="string">We're</span> <span class="string">deeply</span> <span class="string">sorry</span> <span class="string">but</span> <span class="string">an</span> <span class="string">error</span> <span class="string">occured</span></span><br><span class="line">        <span class="attr">shortMessage:</span> <span class="string">Error</span></span><br><span class="line">      <span class="attr">fr:</span></span><br><span class="line">        <span class="attr">longMessage:</span> <span class="string">Nous</span> <span class="string">sommes</span> <span class="string">dÃ©solÃ©</span> <span class="string">mais</span> <span class="string">une</span> <span class="string">erreur</span> <span class="string">est</span> <span class="string">survenu</span></span><br><span class="line">        <span class="attr">shortMessage:</span> <span class="string">Erreur</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br></pre></td></tr></table></figure>

<h4 id="7-4-4-响应消息的示例数据"><a href="#7-4-4-响应消息的示例数据" class="headerlink" title="7.4.4 响应消息的示例数据"></a>7.4.4 响应消息的示例数据</h4><p>我们甚至可以添加响应消息级别的示例数据：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">'/persons/&#123;username&#125;/collecting-items'</span><span class="string">:</span></span><br><span class="line">    <span class="string">……</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="string">……</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">'200':</span></span><br><span class="line"><span class="comment">#START############################################################################</span></span><br><span class="line">          <span class="attr">examples:</span></span><br><span class="line">            <span class="attr">application/json:</span></span><br><span class="line">              <span class="string">&#123;</span></span><br><span class="line">                <span class="attr">"totalItems":</span> <span class="number">10</span><span class="string">,</span></span><br><span class="line">                <span class="attr">"totalPage":</span> <span class="number">4</span><span class="string">,</span></span><br><span class="line">                <span class="attr">"pageSize":</span> <span class="number">3</span><span class="string">,</span></span><br><span class="line">                <span class="attr">"currentPage":</span> <span class="number">2</span><span class="string">,</span></span><br><span class="line">                <span class="attr">"items":</span> </span><br><span class="line">                <span class="string">[</span></span><br><span class="line">                  <span class="string">&#123;</span> </span><br><span class="line">                    <span class="attr">"itemType":</span> <span class="string">"Vinyl"</span><span class="string">,</span></span><br><span class="line">                    <span class="attr">"maxPrice":</span> <span class="number">20</span><span class="string">,</span></span><br><span class="line">                    <span class="attr">"imageId":</span> <span class="string">"98096838-04eb-4bac-b32e-cd5b7196de71"</span><span class="string">,</span></span><br><span class="line">                    <span class="attr">"albumName":</span> <span class="string">"Captain Future Original Soundtrack"</span><span class="string">,</span></span><br><span class="line">                    <span class="attr">"artist":</span> <span class="string">"Yuji Ohno"</span></span><br><span class="line">                  <span class="string">&#125;,</span></span><br><span class="line">                  <span class="string">&#123;</span> </span><br><span class="line">                    <span class="attr">"itemType":</span> <span class="string">"VHS"</span><span class="string">,</span></span><br><span class="line">                    <span class="attr">"maxPrice":</span> <span class="number">10</span><span class="string">,</span></span><br><span class="line">                    <span class="attr">"imageId":</span> <span class="string">"b74469bc-e6a1-4a90-858a-88ef94079356"</span><span class="string">,</span></span><br><span class="line">                    <span class="attr">"movieTitle":</span> <span class="string">"Star Crash"</span><span class="string">,</span></span><br><span class="line">                    <span class="attr">"director":</span> <span class="string">"Luigi Cozzi"</span></span><br><span class="line">                  <span class="string">&#125;,</span></span><br><span class="line">                  <span class="string">&#123;</span> </span><br><span class="line">                    <span class="attr">"itemType":</span> <span class="string">"AudioCassette"</span><span class="string">,</span></span><br><span class="line">                    <span class="attr">"maxPrice":</span> <span class="number">10</span><span class="string">,</span></span><br><span class="line">                    <span class="attr">"imageId":</span> <span class="string">"b74469bc-e6a1-4a90-858a-88ef94079356"</span><span class="string">,</span></span><br><span class="line">                    <span class="attr">"albumName":</span> <span class="string">"Star Wars"</span><span class="string">,</span></span><br><span class="line">                    <span class="attr">"artist":</span> <span class="string">"John Williams"</span></span><br><span class="line">                  <span class="string">&#125;</span></span><br><span class="line">                <span class="string">]</span></span><br><span class="line">              <span class="string">&#125;</span></span><br><span class="line"><span class="comment"># END ############################################################################</span></span><br><span class="line">        <span class="attr">'404':</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">'#/responses/PersonDoesNotExistResponse'</span></span><br><span class="line">        <span class="attr">'500':</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">'#/responses/Standard500ErrorResponse'</span></span><br><span class="line">        <span class="attr">default:</span></span><br><span class="line">          <span class="string">$ref:</span> <span class="string">'#/responses/TotallyUnexpectedResponse'</span></span><br></pre></td></tr></table></figure>

<h4 id="7-4-5-示例数据的优先级"><a href="#7-4-5-示例数据的优先级" class="headerlink" title="7.4.5 示例数据的优先级"></a>7.4.5 示例数据的优先级</h4><p>如果我们在各个级别（比如参数、对象、定义、响应消息）都添加了示例数据。支持OpenAPI规范的各解析工具<strong>都是</strong>以 <strong>最高级别</strong> 的定义为准。</p>
<h3 id="7-5-标记为弃用"><a href="#7-5-标记为弃用" class="headerlink" title="7.5 标记为弃用"></a>7.5 标记为弃用</h3><p>我们可以通过关键字<code>deprecated</code>置为 <em>true</em> 来标记接口的<strong>弃用</strong>状态，比如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">/js-less-consumer-persons:</span></span><br><span class="line">  <span class="attr">parameters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br><span class="line">  <span class="attr">post:</span></span><br><span class="line">    <span class="attr">summary:</span> <span class="string">Creates</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">    <span class="attr">description:</span> <span class="string">For</span> <span class="string">JS-less</span> <span class="string">partners</span></span><br><span class="line">    <span class="attr">operationId:</span> <span class="string">createUserJS</span></span><br><span class="line">    <span class="attr">deprecated:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h3 id="7-6-链接到外部文档"><a href="#7-6-链接到外部文档" class="headerlink" title="7.6 链接到外部文档"></a>7.6 链接到外部文档</h3><p>一般来说，项目中不光只有一篇API文档，还应该有些描述application key，测试用例，操作链以及其他内容的文档，这些文档一般是单独成篇的。如果在描述某个接口时，我们想链接这些文档，可以通过关键字<code>externalDoc</code>来添加，例如：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">externalDocs:</span> </span><br><span class="line">  <span class="attr">description:</span> <span class="string">Complete</span> <span class="string">documentation</span> <span class="string">describing</span> <span class="string">how</span> <span class="string">to</span> <span class="string">use</span> <span class="string">this</span> <span class="string">API</span></span><br><span class="line">  <span class="attr">url:</span> <span class="string">http://doc.simple.api/</span></span><br><span class="line">  <span class="string">/images:</span></span><br><span class="line">    <span class="attr">parameters:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$ref:</span> <span class="string">'#/parameters/userAgent'</span></span><br><span class="line">    <span class="attr">post:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Uploads</span> <span class="string">an</span> <span class="string">image</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Upload</span> <span class="string">an</span> <span class="string">image,</span> <span class="string">will</span> <span class="string">return</span> <span class="string">an</span> <span class="string">image</span> <span class="string">id.</span> </span><br><span class="line">      <span class="attr">operationId:</span> <span class="string">storeImage</span></span><br><span class="line">      <span class="attr">externalDocs:</span></span><br><span class="line">        <span class="attr">description:</span> <span class="string">How</span> <span class="string">to</span> <span class="string">upload</span> <span class="string">media</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">http://doc.simple.api/media/upload</span></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="八、-分而治之"><a href="#八、-分而治之" class="headerlink" title="八、 分而治之"></a>八、 分而治之</h2><p>根据前面几张的知识，我们已经可以轻松的构建一个复杂的API文档了。可是作为一个学过 <em>Clean Code</em> 的程序员，我们并不希望所有的接口、定义都在一个<strong>大而全</strong>的上帝文件里。这一章我们一起来学习拆分文件。</p>
<h3 id="8-1-JSON指针"><a href="#8-1-JSON指针" class="headerlink" title="8.1 JSON指针"></a>8.1 JSON指针</h3><p>我们在第2章已经知道了怎么定义一个可重用的对象，已经如何使用定义，重温一下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">  <span class="string">/persons/&#123;username&#125;:</span></span><br><span class="line">    <span class="attr">get:</span></span><br><span class="line">      <span class="attr">summary:</span> <span class="string">Gets</span> <span class="string">a</span> <span class="string">person</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">Returns</span> <span class="string">a</span> <span class="string">single</span> <span class="string">person</span> <span class="string">for</span> <span class="string">its</span> <span class="string">username.</span></span><br><span class="line">      <span class="attr">parameters:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">in:</span> <span class="string">path</span></span><br><span class="line">          <span class="attr">required:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">person's</span> <span class="string">username</span></span><br><span class="line">          <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">responses:</span></span><br><span class="line">        <span class="attr">200:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">A</span> <span class="string">Person</span></span><br><span class="line">          <span class="attr">schema:</span></span><br><span class="line">            <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br><span class="line">        <span class="attr">404:</span></span><br><span class="line">          <span class="attr">description:</span> <span class="string">The</span> <span class="string">Person</span> <span class="string">does</span> <span class="string">not</span> <span class="string">exists.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">definitions:</span></span><br><span class="line">  <span class="attr">Person:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">Persons:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">    <span class="attr">items:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/definitions/Person"</span></span><br></pre></td></tr></table></figure>

<p>在使用的时候我们这样写：<em>$ref: “#/definitions/Person”</em> ，<code>$ref</code>就是<strong>JSON指针</strong>（参见定义<a href="https://tools.ietf.org/html/rfc6901" target="_blank" rel="noopener">RFC6901</a>）。例子中的这个指针指向<strong>当前文档根路径（#）</strong>下的<em>definitions</em> 下的 <em>Person</em>。</p>
<p>JSON指针不仅可以指向当前文件，还可以指向其他文件。</p>
<h3 id="8-2-基础拆分"><a href="#8-2-基础拆分" class="headerlink" title="8.2 基础拆分"></a>8.2 基础拆分</h3><h3 id="8-2-1-引用本地文件"><a href="#8-2-1-引用本地文件" class="headerlink" title="8.2.1 引用本地文件"></a>8.2.1 引用本地文件</h3><p>还是上面这个例子，我们在当前文档的同一目录下，新建的一个文件叫 <code>person.yaml</code>，然后把<em>Person</em> 的定义拆出来，放在其中。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Person:</span></span><br><span class="line">  <span class="attr">required:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">  <span class="attr">properties:</span></span><br><span class="line">    <span class="attr">firstName:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">    <span class="attr">lastName:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">    <span class="attr">username:</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure>

<p>在当前文档中把引用 <em>Person</em> 定义的地方修改为：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$ref:</span> <span class="string">"person.yaml#/Person"</span></span><br></pre></td></tr></table></figure>

<h4 id="8-2-2-编辑器报错"><a href="#8-2-2-编辑器报错" class="headerlink" title="8.2.2 编辑器报错"></a>8.2.2 编辑器报错</h4><p>把上面的代码放到Swagger Editor中编辑，编辑器预览中可能会报错：</p>
<p><img src="http://apihandyman.io/wp-content/uploads/2016/07/openapi8-editor-error.png" alt="editor reference error"></p>
<p>提示找不到person.yaml文件。这是因为我们<strong>没有指定正确的编辑器的指针解析基础路径（Pointer Resolution Base Path）</strong> 。</p>
<p>解决的办法是：进入编辑器的 <em>Preferences -&gt; Preferences 菜单</em>，修改<code>Pointer Resolution Base Path</code>为：</p>
<p><img src="http://apihandyman.io/wp-content/uploads/2016/07/openapi8-editor-preferences-pointer-modified.png" alt="editor preferences original"></p>
<p>考虑到缓存的原因，如果错误依然存在，请刷新浏览器。</p>
<h4 id="8-2-3-文件夹"><a href="#8-2-3-文件夹" class="headerlink" title="8.2.3 文件夹"></a>8.2.3 文件夹</h4><p>如果引用子文件夹下的文件，我们可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$ref:</span> <span class="string">"folder/person.yaml#/Person"</span></span><br></pre></td></tr></table></figure>

<p>如果引用上级文件夹下的文件，我们可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">Persons:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">  <span class="attr">items:</span></span><br><span class="line">    <span class="string">$ref:</span> <span class="string">"../folder/person.yaml#/Person"</span></span><br></pre></td></tr></table></figure>

<h4 id="8-2-4-引用远程文件"><a href="#8-2-4-引用远程文件" class="headerlink" title="8.2.4 引用远程文件"></a>8.2.4 引用远程文件</h4><p>如果我们想引用一个远程文件，应该怎么做呢？可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$ref:</span> <span class="string">https://myserver.com/mypath/myfile.yaml#/example</span></span><br></pre></td></tr></table></figure>

<p>但是需要注意的是：<strong>服务器必须提供跨域（CORS）访问服务</strong>。</p>
<p>如果要通过本地服务器上的8080端口引用文件，我们可以这样写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$ref:</span> <span class="string">"http://localhost:8080/folder/person.yaml#/Person"</span></span><br></pre></td></tr></table></figure>

<p>考虑两种比较特别的情况：</p>
<h5 id="8-2-4-1-远端文件引用”本地文件”"><a href="#8-2-4-1-远端文件引用”本地文件”" class="headerlink" title="8.2.4.1 远端文件引用”本地文件”"></a>8.2.4.1 远端文件引用”本地文件”</h5><p>比如说，我们引用了：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$ref:</span> <span class="string">"http://localhost:8080/another-folder/persons.yaml#/Persons"</span></span><br></pre></td></tr></table></figure>

<p>这个远端文件。但是<code>persons.yaml</code>又引用了与它在同一目录下的<code>person.yaml</code>文件，这个时候语法分析器会在<code>localhost:8080</code>上面找<code>person.yaml</code>文件，而不会查找我们本地的<code>person.yaml</code>。</p>
<h5 id="8-2-4-2-远端文件引用-”更“远端文件"><a href="#8-2-4-2-远端文件引用-”更“远端文件" class="headerlink" title="8.2.4.2 远端文件引用 ”更“远端文件"></a>8.2.4.2 远端文件引用 ”更“远端文件</h5><p>如果理解了8.2.4.1这个例子，我们就知道不管怎么引用，都是在相对于被引用的文件下来进行查找的。</p>
<h4 id="8-2-5-整理一个文件中的多个定义"><a href="#8-2-5-整理一个文件中的多个定义" class="headerlink" title="8.2.5 整理一个文件中的多个定义"></a>8.2.5 整理一个文件中的多个定义</h4><p>比如我们在一个文件中，需要把定义分成几类，可以这样做：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">SomeDefinitions:</span></span><br><span class="line">  <span class="attr">Person:</span></span><br><span class="line">    <span class="attr">required:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">username</span></span><br><span class="line">    <span class="attr">properties:</span></span><br><span class="line">      <span class="attr">firstName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">lastName:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">username:</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">string</span></span><br><span class="line"></span><br><span class="line"><span class="attr">OtherDefinitions:</span></span><br><span class="line">  <span class="attr">Persons:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">array</span></span><br><span class="line">    <span class="attr">items:</span></span><br><span class="line">      <span class="string">$ref:</span> <span class="string">"#/SomeDefinitions/Person"</span></span><br></pre></td></tr></table></figure>

<p><code>Person</code>归属于<code>SomeDefinitions</code>这一类，<code>Persons</code>归属于<code>OtherDefinitions</code>这一类。那么我们在引用这两个定义时，分别应该这样书写：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">$ref:</span> <span class="string">"definitions.yaml#/OtherDefinitions/Persons"</span></span><br><span class="line"><span class="string">$ref:</span> <span class="string">"definitions.yaml#/SomeDefinitions/Person"</span></span><br></pre></td></tr></table></figure>

<p>有点像<strong>命名空间</strong>的概念。</p>
<h3 id="8-3-实战切分的思路"><a href="#8-3-实战切分的思路" class="headerlink" title="8.3 实战切分的思路"></a>8.3 实战切分的思路</h3><ul>
<li>结构化切分思路： 先把API文档的头部<code>info</code>切下来，放在<code>info.yaml</code>，然后分别切分 <code>paths.yaml</code>，<code>definitions.yaml</code>，<code>responses.yaml</code>，<code>parameters.yaml</code>等文件，最后合并到<code>main.yaml</code>；</li>
<li>分层切分思路：分别按照<strong>功能</strong>和<strong>层次</strong>，将文件切分为<code>base.yaml</code>或<code>common.yaml</code>，然后是各个模块的<code>xxx-paths.yaml</code>，然后是各个定义的<code>xxx-definitions.yaml</code>。</li>
<li>其他思路……</li>
</ul>
<p>需要注意的是，不管怎么切分，有一个原则必须谨记：</p>
<p>**切分出来的子文档，必须遵循OpenAPI规范，能够通过编辑器的校验，不然切分得再漂亮也是徒劳。</p>

      
    </div>

    
      


    

    
    
    

    
      <div>
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
    <img id="wechat_subscriber_qcode" src="/images/weixin.jpg" alt="刘小恺(Kyle) wechat" style="width: 200px; max-width: 100%;"/>
    <div>如有疑问可联系博主</div>
</div>

      </div>
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Golang/" rel="tag"><i class="fa fa-tag"></i> Golang</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
            
               <div id="needsharebutton-postbottom">
                 <span class="btn">
                    <i class="fa fa-share-alt" aria-hidden="true"></i>
                 </span>
               </div>
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/12/12.%E5%8C%BA%E5%9D%97%E9%93%BE/Hyperledger%20fabric/3.Fabric%20%E7%A4%BA%E4%BE%8B%E5%BA%94%E7%94%A8%E6%90%AD%E5%BB%BA/" rel="next" title="Fabric 示例应用搭建">
                <i class="fa fa-chevron-left"></i> Fabric 示例应用搭建
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/04/29/11.Golang/Golang%E5%B7%A5%E5%85%B7%E5%8C%85/swagger%E4%BB%8E%E6%BA%90%E7%A0%81%E7%94%9F%E6%88%90spec/" rel="prev" title="swagger从源码生成spec">
                swagger从源码生成spec <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="刘小恺(Kyle)" />
            
              <p class="site-author-name" itemprop="name">刘小恺(Kyle)</p>
              <p class="site-description motion-element" itemprop="description">吃喝玩乐、好吃懒做、醉生梦死、不劳而获</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/%20%7C%7C%20archive">
                
                    <span class="site-state-item-count">309</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">82</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">92</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/KyleAdultHub" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:liukaijian45@163.com" target="_blank" title="E-Mail" rel="external nofollow"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#一、Swagger简介"><span class="nav-text">一、Swagger简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是swagger"><span class="nav-text">什么是swagger</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Go-swagger文档配置文件示例"><span class="nav-text">Go swagger文档配置文件示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Go-swagger-环境安装"><span class="nav-text">Go-swagger 环境安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#语言选择-JSON-vs-YAML"><span class="nav-text">语言选择: JSON vs YAML</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#二、基本的swagger-api定义方法"><span class="nav-text">二、基本的swagger api定义方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-最简单的例子"><span class="nav-text">2.1 最简单的例子</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-1-OpenAPI规范的版本号"><span class="nav-text">2.1.1 OpenAPI规范的版本号</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-2-API描述信息"><span class="nav-text">2.1.2 API描述信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-3-API的URL"><span class="nav-text">2.1.3 API的URL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-1-4-API的操作（operation）"><span class="nav-text">2.1.4 API的操作（operation）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-定义一个API操作"><span class="nav-text">2.2 定义一个API操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-1-添加一个路径（path）"><span class="nav-text">2.2.1 添加一个路径（path）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-2-在路径中添加一个HTTP方法"><span class="nav-text">2.2.2 在路径中添加一个HTTP方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-3-定义响应（response）类型"><span class="nav-text">2.2.3 定义响应（response）类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-2-4-定义响应内容"><span class="nav-text">2.2.4 定义响应内容</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-定义请求参数（query-parameters）"><span class="nav-text">2.3 定义请求参数（query parameters）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-1-在get方法中增加请求参数"><span class="nav-text">2.3.1 在get方法中增加请求参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-3-2-添加分页参数"><span class="nav-text">2.3.2 添加分页参数</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-定义路径参数（path-parameter）"><span class="nav-text">2.4 定义路径参数（path parameter）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-1-添加一个-get-persons-username-操作"><span class="nav-text">2.4.1 添加一个 get &#x2F;persons&#x2F;{username} 操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-2-定义路径参数-username"><span class="nav-text">2.4.2 定义路径参数 username</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-4-3-定义响应消息"><span class="nav-text">2.4.3 定义响应消息</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-定义消息体参数（body-parameter）"><span class="nav-text">2.5 定义消息体参数（body parameter）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-1-添加一个-post-persons-操作"><span class="nav-text">2.5.1 添加一个 post &#x2F;persons 操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-2-定义消息体参数"><span class="nav-text">2.5.2 定义消息体参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-5-3-定义响应消息"><span class="nav-text">2.5.3 定义响应消息</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#三、文档瘦身"><span class="nav-text">三、文档瘦身</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-简化数据模型"><span class="nav-text">3.1 简化数据模型</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-添加定义-（definitions）项"><span class="nav-text">3.1.1 添加定义 （definitions）项</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-2-增加一个可重用的（对象）定义"><span class="nav-text">3.1.2 增加一个可重用的（对象）定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-3-引用一个定义来增加另一个定义"><span class="nav-text">3.1.3 引用一个定义来增加另一个定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-4-在响应消息中使用定义"><span class="nav-text">3.1.4 在响应消息中使用定义</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-1-4-1-get-persons"><span class="nav-text">3.1.4.1 get&#x2F;persons</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-1-4-2-get-persons-username"><span class="nav-text">3.1.4.2 get&#x2F;persons&#x2F;{username}</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-5-在参数中使用定义"><span class="nav-text">3.1.5 在参数中使用定义</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-1-5-1-post-persons"><span class="nav-text">3.1.5.1 post &#x2F;persons</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-简化响应消息"><span class="nav-text">3.2 简化响应消息</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-定义可重用的HTTP-500-响应"><span class="nav-text">3.2.1 定义可重用的HTTP 500 响应</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-2-增加一个Error定义"><span class="nav-text">3.2.2 增加一个Error定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-3-定义一个可重用的响应消息"><span class="nav-text">3.2.3 定义一个可重用的响应消息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-4-使用已定义的响应消息"><span class="nav-text">3.2.4 使用已定义的响应消息</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-4-1-get-users"><span class="nav-text">3.2.4.1 get &#x2F;users</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-4-2-post-users"><span class="nav-text">3.2.4.2 post&#x2F;users</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-2-4-3-get-users-username"><span class="nav-text">3.2.4.3 get&#x2F;users&#x2F;{username}</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-简化参数定义"><span class="nav-text">3.3 简化参数定义</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-路径参数只定义一次"><span class="nav-text">3.3.1 路径参数只定义一次</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-定义可重用的参数"><span class="nav-text">3.3.2 定义可重用的参数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-2-1-定义可重用的参数"><span class="nav-text">3.3.2.1 定义可重用的参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#3-3-2-2-使用定义参数"><span class="nav-text">3.3.2.2 使用定义参数</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#3-3-2-2-1-get-persons"><span class="nav-text">3.3.2.2.1 get &#x2F;persons</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-3-2-2-2-get-和-delete-persons-username"><span class="nav-text">3.3.2.2.2 get 和 delete &#x2F;persons&#x2F;{username}</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#3-3-2-2-3-get-persons-username-friends"><span class="nav-text">3.3.2.2.3 get &#x2F;persons&#x2F;{username}&#x2F;friends</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四、深入了解一下"><span class="nav-text">四、深入了解一下</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-私人定制"><span class="nav-text">4.1 私人定制</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-1-字符串（Strings）长度和格式"><span class="nav-text">4.1.1 字符串（Strings）长度和格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-2-日期和时间"><span class="nav-text">4.1.2 日期和时间</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-3-数字类型和范围"><span class="nav-text">4.1.3 数字类型和范围</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-4-枚举类型"><span class="nav-text">4.1.4 枚举类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-5-数值的大小和唯一性"><span class="nav-text">4.1.5 数值的大小和唯一性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-1-6-二进制数据"><span class="nav-text">4.1.6 二进制数据</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-高级数据定义"><span class="nav-text">4.2 高级数据定义</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-1-读写操作同一定义的数据"><span class="nav-text">4.2.1 读写操作同一定义的数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-2-组合定义确保一致性"><span class="nav-text">4.2.2 组合定义确保一致性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-2-3-数据模型的继承（TODO）"><span class="nav-text">4.2.3 数据模型的继承（TODO）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、-输入输出模型"><span class="nav-text">五、 输入输出模型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-高级参数定义"><span class="nav-text">5.1 高级参数定义</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-1-必带参数和可选参数"><span class="nav-text">5.1.1 必带参数和可选参数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-1-定义必带参数和可选参数"><span class="nav-text">5.1.1.1 定义必带参数和可选参数</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-1-2-定义必带属性和可选属性"><span class="nav-text">5.1.1.2 定义必带属性和可选属性</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-2-带默认值的参数"><span class="nav-text">5.1.2 带默认值的参数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-2-1-定义参数的默认值"><span class="nav-text">5.1.2.1 定义参数的默认值</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#5-1-2-2-定义属性的默认值"><span class="nav-text">5.1.2.2 定义属性的默认值</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-3-带空值的参数"><span class="nav-text">5.1.3 带空值的参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-4-参数组"><span class="nav-text">5.1.4 参数组</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-5-消息头（Header）参数"><span class="nav-text">5.1.5 消息头（Header）参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-6-表单参数"><span class="nav-text">5.1.6 表单参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-7-文件参数"><span class="nav-text">5.1.7 文件参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-1-8-参数的媒体类型"><span class="nav-text">5.1.8 参数的媒体类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-高级响应消息定义"><span class="nav-text">5.2 高级响应消息定义</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-1-不带消息体的响应消息"><span class="nav-text">5.2.1 不带消息体的响应消息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-2-响应消息中的必带参数和可选参数"><span class="nav-text">5.2.2 响应消息中的必带参数和可选参数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-3-响应消息头"><span class="nav-text">5.2.3 响应消息头</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-4-默认响应消息"><span class="nav-text">5.2.4 默认响应消息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-5-响应消息的媒体类型"><span class="nav-text">5.2.5 响应消息的媒体类型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-定义某个参数只存在于响应消息中"><span class="nav-text">5.3 定义某个参数只存在于响应消息中</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六、-不要让API裸奔"><span class="nav-text">六、 不要让API裸奔</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-定义安全"><span class="nav-text">6.1 定义安全</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-1-基础鉴权（Basic-Authentication）"><span class="nav-text">6.1.1 基础鉴权（Basic Authentication）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-2-API秘钥鉴权（API-Key）"><span class="nav-text">6.1.2 API秘钥鉴权（API Key）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-1-3-Oauth2鉴权"><span class="nav-text">6.1.3 Oauth2鉴权</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-3-1-流程（Flow）和URL"><span class="nav-text">6.1.3.1 流程（Flow）和URL</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-1-3-2-作用范围（scope）"><span class="nav-text">6.1.3.2 作用范围（scope）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-使用安全定义"><span class="nav-text">6.2 使用安全定义</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-基础鉴权"><span class="nav-text">6.2.1 基础鉴权</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#6-2-1-1-API级别"><span class="nav-text">6.2.1.1 API级别</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#6-2-1-2-操作级别"><span class="nav-text">6.2.1.2 操作级别</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-2-API秘钥鉴权"><span class="nav-text">6.2.2 API秘钥鉴权</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-Oauth2鉴权"><span class="nav-text">6.2.3 Oauth2鉴权</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-使用多种安全配置"><span class="nav-text">6.3 使用多种安全配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-1-安全定义"><span class="nav-text">6.3.1 安全定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-2-全局安全配置"><span class="nav-text">6.3.2 全局安全配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-3-3-覆盖全局配置"><span class="nav-text">6.3.3 覆盖全局配置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#七、-让文档的可读性更好"><span class="nav-text">七、 让文档的可读性更好</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-分类标签（Tags）"><span class="nav-text">7.1 分类标签（Tags）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-1-单标签"><span class="nav-text">7.1.1 单标签</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-2-多标签"><span class="nav-text">7.1.2 多标签</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-无处不在的描述文字（Descriptions）"><span class="nav-text">7.2 无处不在的描述文字（Descriptions）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-1-安全项的描述"><span class="nav-text">7.2.1 安全项的描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-2-模式（Schema）的描述"><span class="nav-text">7.2.2 模式（Schema）的描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-3-属性的描述"><span class="nav-text">7.2.3 属性的描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-4-参数的描述"><span class="nav-text">7.2.4 参数的描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-5-操作的概述（summary）、描述和操作ID（operationId）"><span class="nav-text">7.2.5 操作的概述（summary）、描述和操作ID（operationId）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-6-响应消息的描述"><span class="nav-text">7.2.6 响应消息的描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-7-响应消息头的描述"><span class="nav-text">7.2.7 响应消息头的描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-2-8-标签的描述"><span class="nav-text">7.2.8 标签的描述</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-在描述中使用Markdown语法"><span class="nav-text">7.3 在描述中使用Markdown语法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3-1-多行描述"><span class="nav-text">7.3.1 多行描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3-2-简单使用GFM"><span class="nav-text">7.3.2 简单使用GFM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3-3-带信息组的描述"><span class="nav-text">7.3.3 带信息组的描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-3-4-带代码的描述"><span class="nav-text">7.3.4 带代码的描述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-2-对象属性的示例数据"><span class="nav-text">7.4.2 对象属性的示例数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-3-定义的示例数据"><span class="nav-text">7.4.3 定义的示例数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-4-响应消息的示例数据"><span class="nav-text">7.4.4 响应消息的示例数据</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-4-5-示例数据的优先级"><span class="nav-text">7.4.5 示例数据的优先级</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-5-标记为弃用"><span class="nav-text">7.5 标记为弃用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-6-链接到外部文档"><span class="nav-text">7.6 链接到外部文档</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#八、-分而治之"><span class="nav-text">八、 分而治之</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-JSON指针"><span class="nav-text">8.1 JSON指针</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-基础拆分"><span class="nav-text">8.2 基础拆分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-1-引用本地文件"><span class="nav-text">8.2.1 引用本地文件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-2-编辑器报错"><span class="nav-text">8.2.2 编辑器报错</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-3-文件夹"><span class="nav-text">8.2.3 文件夹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-4-引用远程文件"><span class="nav-text">8.2.4 引用远程文件</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#8-2-4-1-远端文件引用”本地文件”"><span class="nav-text">8.2.4.1 远端文件引用”本地文件”</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#8-2-4-2-远端文件引用-”更“远端文件"><span class="nav-text">8.2.4.2 远端文件引用 ”更“远端文件</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-2-5-整理一个文件中的多个定义"><span class="nav-text">8.2.5 整理一个文件中的多个定义</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-实战切分的思路"><span class="nav-text">8.3 实战切分的思路</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">刘小恺(Kyle)</span>

  

  
</div>


  










        








        
      </div>
    </footer>

    

    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt" aria-hidden="true"></i>
        </span>
      </div>
    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.2"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'V62wzdGpgPV7y1tPnu1v1KYX-gzGzoHsz',
        appKey: 'SkJs3cwXAUsdgr6BkxmW2ctm',
        placeholder: '客观(*╹▽╹*)，请留下您的宝贵意见...   \n 请用浏览器打开进行评论, 在微信或其他客户端可能导致作者收不到提醒 \n 信息栏作用:\n 昵称: 在评论中显示的昵称 \n 邮箱: 可以在收到您评论的回复后通知到您邮箱 \n 网址: 评论需要跳转链接可填写, 将可以通过点击您评论中的昵称进行跳转 \n',
        avatar:'monsterid',
        meta:guest,
        pageSize:'10' || 10,
        visitor: false
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('100');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  
  
  
  <script src="/lib/needsharebutton/needsharebutton.js"></script>

  <script>
    
      pbOptions = {};
      
          pbOptions.iconStyle = "box";
      
          pbOptions.boxForm = "horizontal";
      
          pbOptions.position = "bottomCenter";
      
          pbOptions.networks = "Wechat,Weibo,QQZone";
      
      new needShareButton('#needsharebutton-postbottom', pbOptions);
    
    
      flOptions = {};
      
          flOptions.iconStyle = "box";
      
          flOptions.boxForm = "horizontal";
      
          flOptions.position = "middleRight";
      
          flOptions.networks = "Wechat,Weibo,QQZone";
      
      new needShareButton('#needsharebutton-float', flOptions);
    
  </script>

  

  

  

  

  

  

  
</body>
</html>
